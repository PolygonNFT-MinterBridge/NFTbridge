{"ast":null,"code":"'use strict';\n\nvar crc;\n\ntry {\n  crc = require('fast-crc32c');\n} catch (e) {\n  crc = require('./crc32c.js');\n}\n\nvar crypto = require('crypto');\n\nvar {\n  PassThrough\n} = require('stream');\n\nmodule.exports = function (cfg) {\n  cfg = cfg || {};\n  var crc32c = cfg.crc32c !== false;\n  var md5 = cfg.md5 !== false;\n  var hashes = {};\n  if (md5) hashes.md5 = crypto.createHash('md5');\n\n  var onData = function (chunk, enc, done) {\n    if (crc32c) hashes.crc32c = crc.calculate(chunk, hashes.crc32c || 0);\n    if (md5) hashes.md5.update(chunk);\n    done(null, chunk);\n  };\n\n  var onFlush = function (done) {\n    if (crc32c) hashes.crc32c = Buffer.from([hashes.crc32c]).toString('base64');\n    if (md5) hashes.md5 = hashes.md5.digest('base64');\n    done();\n  };\n\n  var validationStream = new PassThrough({\n    transform: onData,\n    flush: onFlush\n  });\n\n  validationStream.test = function (algo, sum) {\n    return hashes[algo] === sum;\n  };\n\n  return validationStream;\n};","map":{"version":3,"sources":["/Users/piyushmaheshwari/Downloads/github/Bridgeorg/node_modules/hash-stream-validation/index.js"],"names":["crc","require","e","crypto","PassThrough","module","exports","cfg","crc32c","md5","hashes","createHash","onData","chunk","enc","done","calculate","update","onFlush","Buffer","from","toString","digest","validationStream","transform","flush","test","algo","sum"],"mappings":"AAAA;;AAEA,IAAIA,GAAJ;;AACA,IAAI;AACFA,EAAAA,GAAG,GAAGC,OAAO,CAAC,aAAD,CAAb;AACD,CAFD,CAEE,OAAOC,CAAP,EAAU;AACVF,EAAAA,GAAG,GAAGC,OAAO,CAAC,aAAD,CAAb;AACD;;AAED,IAAIE,MAAM,GAAGF,OAAO,CAAC,QAAD,CAApB;;AACA,IAAI;AAAEG,EAAAA;AAAF,IAAkBH,OAAO,CAAC,QAAD,CAA7B;;AAEAI,MAAM,CAACC,OAAP,GAAiB,UAAUC,GAAV,EAAe;AAC9BA,EAAAA,GAAG,GAAGA,GAAG,IAAI,EAAb;AAEA,MAAIC,MAAM,GAAGD,GAAG,CAACC,MAAJ,KAAe,KAA5B;AACA,MAAIC,GAAG,GAAGF,GAAG,CAACE,GAAJ,KAAY,KAAtB;AAEA,MAAIC,MAAM,GAAG,EAAb;AACA,MAAID,GAAJ,EAASC,MAAM,CAACD,GAAP,GAAaN,MAAM,CAACQ,UAAP,CAAkB,KAAlB,CAAb;;AAET,MAAIC,MAAM,GAAG,UAAUC,KAAV,EAAiBC,GAAjB,EAAsBC,IAAtB,EAA4B;AACvC,QAAIP,MAAJ,EAAYE,MAAM,CAACF,MAAP,GAAgBR,GAAG,CAACgB,SAAJ,CAAcH,KAAd,EAAqBH,MAAM,CAACF,MAAP,IAAiB,CAAtC,CAAhB;AACZ,QAAIC,GAAJ,EAASC,MAAM,CAACD,GAAP,CAAWQ,MAAX,CAAkBJ,KAAlB;AAETE,IAAAA,IAAI,CAAC,IAAD,EAAOF,KAAP,CAAJ;AACD,GALD;;AAOA,MAAIK,OAAO,GAAG,UAAUH,IAAV,EAAgB;AAC5B,QAAIP,MAAJ,EAAYE,MAAM,CAACF,MAAP,GAAgBW,MAAM,CAACC,IAAP,CAAY,CAACV,MAAM,CAACF,MAAR,CAAZ,EAA6Ba,QAA7B,CAAsC,QAAtC,CAAhB;AACZ,QAAIZ,GAAJ,EAASC,MAAM,CAACD,GAAP,GAAaC,MAAM,CAACD,GAAP,CAAWa,MAAX,CAAkB,QAAlB,CAAb;AAETP,IAAAA,IAAI;AACL,GALD;;AAOA,MAAIQ,gBAAgB,GAAG,IAAInB,WAAJ,CAAgB;AACrCoB,IAAAA,SAAS,EAAEZ,MAD0B;AAErCa,IAAAA,KAAK,EAAEP;AAF8B,GAAhB,CAAvB;;AAKAK,EAAAA,gBAAgB,CAACG,IAAjB,GAAwB,UAAUC,IAAV,EAAgBC,GAAhB,EAAqB;AAC3C,WAAOlB,MAAM,CAACiB,IAAD,CAAN,KAAiBC,GAAxB;AACD,GAFD;;AAIA,SAAOL,gBAAP;AACD,CAjCD","sourcesContent":["'use strict'\n\nvar crc\ntry {\n  crc = require('fast-crc32c')\n} catch (e) {\n  crc = require('./crc32c.js')\n}\n\nvar crypto = require('crypto')\nvar { PassThrough } = require('stream')\n\nmodule.exports = function (cfg) {\n  cfg = cfg || {}\n\n  var crc32c = cfg.crc32c !== false\n  var md5 = cfg.md5 !== false\n\n  var hashes = {}\n  if (md5) hashes.md5 = crypto.createHash('md5')\n\n  var onData = function (chunk, enc, done) {\n    if (crc32c) hashes.crc32c = crc.calculate(chunk, hashes.crc32c || 0)\n    if (md5) hashes.md5.update(chunk)\n\n    done(null, chunk)\n  }\n\n  var onFlush = function (done) {\n    if (crc32c) hashes.crc32c = Buffer.from([hashes.crc32c]).toString('base64')\n    if (md5) hashes.md5 = hashes.md5.digest('base64')\n\n    done()\n  }\n\n  var validationStream = new PassThrough({\n    transform: onData,\n    flush: onFlush\n  })\n\n  validationStream.test = function (algo, sum) {\n    return hashes[algo] === sum\n  }\n\n  return validationStream\n}\n"]},"metadata":{},"sourceType":"script"}