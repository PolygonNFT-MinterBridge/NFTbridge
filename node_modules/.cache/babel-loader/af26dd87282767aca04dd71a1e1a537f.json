{"ast":null,"code":"/*! firebase-admin v9.6.0 */\n\"use strict\";\n/*!\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ExponentialBackoffPoller = exports.ApiSettings = exports.AuthorizedHttpClient = exports.parseHttpResponse = exports.HttpClient = exports.defaultRetryConfig = exports.HttpError = void 0;\n\nvar error_1 = require(\"./error\");\n\nvar validator = require(\"./validator\");\n\nvar http = require(\"http\");\n\nvar https = require(\"https\");\n\nvar url = require(\"url\");\n\nvar events_1 = require(\"events\");\n\nvar DefaultHttpResponse =\n/** @class */\nfunction () {\n  /**\n   * Constructs a new HttpResponse from the given LowLevelResponse.\n   */\n  function DefaultHttpResponse(resp) {\n    this.status = resp.status;\n    this.headers = resp.headers;\n    this.text = resp.data;\n\n    try {\n      if (!resp.data) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'HTTP response missing data.');\n      }\n\n      this.parsedData = JSON.parse(resp.data);\n    } catch (err) {\n      this.parsedData = undefined;\n      this.parseError = err;\n    }\n\n    this.request = resp.config.method + \" \" + resp.config.url;\n  }\n\n  Object.defineProperty(DefaultHttpResponse.prototype, \"data\", {\n    get: function () {\n      if (this.isJson()) {\n        return this.parsedData;\n      }\n\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.UNABLE_TO_PARSE_RESPONSE, \"Error while parsing response data: \\\"\" + this.parseError.toString() + \"\\\". Raw server \" + (\"response: \\\"\" + this.text + \"\\\". Status code: \\\"\" + this.status + \"\\\". Outgoing \") + (\"request: \\\"\" + this.request + \".\\\"\"));\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  DefaultHttpResponse.prototype.isJson = function () {\n    return typeof this.parsedData !== 'undefined';\n  };\n\n  return DefaultHttpResponse;\n}();\n/**\n * Represents a multipart HTTP response. Parts that constitute the response body can be accessed\n * via the multipart getter. Getters for text and data throw errors.\n */\n\n\nvar MultipartHttpResponse =\n/** @class */\nfunction () {\n  function MultipartHttpResponse(resp) {\n    this.status = resp.status;\n    this.headers = resp.headers;\n    this.multipart = resp.multipart;\n  }\n\n  Object.defineProperty(MultipartHttpResponse.prototype, \"text\", {\n    get: function () {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.UNABLE_TO_PARSE_RESPONSE, 'Unable to parse multipart payload as text');\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(MultipartHttpResponse.prototype, \"data\", {\n    get: function () {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.UNABLE_TO_PARSE_RESPONSE, 'Unable to parse multipart payload as JSON');\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  MultipartHttpResponse.prototype.isJson = function () {\n    return false;\n  };\n\n  return MultipartHttpResponse;\n}();\n\nvar HttpError =\n/** @class */\nfunction (_super) {\n  __extends(HttpError, _super);\n\n  function HttpError(response) {\n    var _this = _super.call(this, \"Server responded with status \" + response.status + \".\") || this;\n\n    _this.response = response; // Set the prototype so that instanceof checks will work correctly.\n    // See: https://github.com/Microsoft/TypeScript/issues/13965\n\n    Object.setPrototypeOf(_this, HttpError.prototype);\n    return _this;\n  }\n\n  return HttpError;\n}(Error);\n\nexports.HttpError = HttpError;\n/**\n * Default retry configuration for HTTP requests. Retries up to 4 times on connection reset and timeout errors\n * as well as HTTP 503 errors. Exposed as a function to ensure that every HttpClient gets its own RetryConfig\n * instance.\n */\n\nfunction defaultRetryConfig() {\n  return {\n    maxRetries: 4,\n    statusCodes: [503],\n    ioErrorCodes: ['ECONNRESET', 'ETIMEDOUT'],\n    backOffFactor: 0.5,\n    maxDelayInMillis: 60 * 1000\n  };\n}\n\nexports.defaultRetryConfig = defaultRetryConfig;\n/**\n * Ensures that the given RetryConfig object is valid.\n *\n * @param retry The configuration to be validated.\n */\n\nfunction validateRetryConfig(retry) {\n  if (!validator.isNumber(retry.maxRetries) || retry.maxRetries < 0) {\n    throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'maxRetries must be a non-negative integer');\n  }\n\n  if (typeof retry.backOffFactor !== 'undefined') {\n    if (!validator.isNumber(retry.backOffFactor) || retry.backOffFactor < 0) {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'backOffFactor must be a non-negative number');\n    }\n  }\n\n  if (!validator.isNumber(retry.maxDelayInMillis) || retry.maxDelayInMillis < 0) {\n    throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'maxDelayInMillis must be a non-negative integer');\n  }\n\n  if (typeof retry.statusCodes !== 'undefined' && !validator.isArray(retry.statusCodes)) {\n    throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'statusCodes must be an array');\n  }\n\n  if (typeof retry.ioErrorCodes !== 'undefined' && !validator.isArray(retry.ioErrorCodes)) {\n    throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'ioErrorCodes must be an array');\n  }\n}\n\nvar HttpClient =\n/** @class */\nfunction () {\n  function HttpClient(retry) {\n    if (retry === void 0) {\n      retry = defaultRetryConfig();\n    }\n\n    this.retry = retry;\n\n    if (this.retry) {\n      validateRetryConfig(this.retry);\n    }\n  }\n  /**\n   * Sends an HTTP request to a remote server. If the server responds with a successful response (2xx), the returned\n   * promise resolves with an HttpResponse. If the server responds with an error (3xx, 4xx, 5xx), the promise rejects\n   * with an HttpError. In case of all other errors, the promise rejects with a FirebaseAppError. If a request fails\n   * due to a low-level network error, transparently retries the request once before rejecting the promise.\n   *\n   * If the request data is specified as an object, it will be serialized into a JSON string. The application/json\n   * content-type header will also be automatically set in this case. For all other payload types, the content-type\n   * header should be explicitly set by the caller. To send a JSON leaf value (e.g. \"foo\", 5), parse it into JSON,\n   * and pass as a string or a Buffer along with the appropriate content-type header.\n   *\n   * @param {HttpRequest} config HTTP request to be sent.\n   * @return {Promise<HttpResponse>} A promise that resolves with the response details.\n   */\n\n\n  HttpClient.prototype.send = function (config) {\n    return this.sendWithRetry(config);\n  };\n  /**\n   * Sends an HTTP request. In the event of an error, retries the HTTP request according to the\n   * RetryConfig set on the HttpClient.\n   *\n   * @param {HttpRequestConfig} config HTTP request to be sent.\n   * @param {number} retryAttempts Number of retries performed up to now.\n   * @return {Promise<HttpResponse>} A promise that resolves with the response details.\n   */\n\n\n  HttpClient.prototype.sendWithRetry = function (config, retryAttempts) {\n    var _this = this;\n\n    if (retryAttempts === void 0) {\n      retryAttempts = 0;\n    }\n\n    return AsyncHttpCall.invoke(config).then(function (resp) {\n      return _this.createHttpResponse(resp);\n    }).catch(function (err) {\n      var _a = _this.getRetryDelayMillis(retryAttempts, err),\n          delayMillis = _a[0],\n          canRetry = _a[1];\n\n      if (canRetry && _this.retry && delayMillis <= _this.retry.maxDelayInMillis) {\n        return _this.waitForRetry(delayMillis).then(function () {\n          return _this.sendWithRetry(config, retryAttempts + 1);\n        });\n      }\n\n      if (err.response) {\n        throw new HttpError(_this.createHttpResponse(err.response));\n      }\n\n      if (err.code === 'ETIMEDOUT') {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.NETWORK_TIMEOUT, \"Error while making request: \" + err.message + \".\");\n      }\n\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.NETWORK_ERROR, \"Error while making request: \" + err.message + \". Error code: \" + err.code);\n    });\n  };\n\n  HttpClient.prototype.createHttpResponse = function (resp) {\n    if (resp.multipart) {\n      return new MultipartHttpResponse(resp);\n    }\n\n    return new DefaultHttpResponse(resp);\n  };\n\n  HttpClient.prototype.waitForRetry = function (delayMillis) {\n    if (delayMillis > 0) {\n      return new Promise(function (resolve) {\n        setTimeout(resolve, delayMillis);\n      });\n    }\n\n    return Promise.resolve();\n  };\n  /**\n   * Checks if a failed request is eligible for a retry, and if so returns the duration to wait before initiating\n   * the retry.\n   *\n   * @param {number} retryAttempts Number of retries completed up to now.\n   * @param {LowLevelError} err The last encountered error.\n   * @returns {[number, boolean]} A 2-tuple where the 1st element is the duration to wait before another retry, and the\n   *     2nd element is a boolean indicating whether the request is eligible for a retry or not.\n   */\n\n\n  HttpClient.prototype.getRetryDelayMillis = function (retryAttempts, err) {\n    if (!this.isRetryEligible(retryAttempts, err)) {\n      return [0, false];\n    }\n\n    var response = err.response;\n\n    if (response && response.headers['retry-after']) {\n      var delayMillis = this.parseRetryAfterIntoMillis(response.headers['retry-after']);\n\n      if (delayMillis > 0) {\n        return [delayMillis, true];\n      }\n    }\n\n    return [this.backOffDelayMillis(retryAttempts), true];\n  };\n\n  HttpClient.prototype.isRetryEligible = function (retryAttempts, err) {\n    if (!this.retry) {\n      return false;\n    }\n\n    if (retryAttempts >= this.retry.maxRetries) {\n      return false;\n    }\n\n    if (err.response) {\n      var statusCodes = this.retry.statusCodes || [];\n      return statusCodes.indexOf(err.response.status) !== -1;\n    }\n\n    if (err.code) {\n      var retryCodes = this.retry.ioErrorCodes || [];\n      return retryCodes.indexOf(err.code) !== -1;\n    }\n\n    return false;\n  };\n  /**\n   * Parses the Retry-After HTTP header as a milliseconds value. Return value is negative if the Retry-After header\n   * contains an expired timestamp or otherwise malformed.\n   */\n\n\n  HttpClient.prototype.parseRetryAfterIntoMillis = function (retryAfter) {\n    var delaySeconds = parseInt(retryAfter, 10);\n\n    if (!isNaN(delaySeconds)) {\n      return delaySeconds * 1000;\n    }\n\n    var date = new Date(retryAfter);\n\n    if (!isNaN(date.getTime())) {\n      return date.getTime() - Date.now();\n    }\n\n    return -1;\n  };\n\n  HttpClient.prototype.backOffDelayMillis = function (retryAttempts) {\n    if (retryAttempts === 0) {\n      return 0;\n    }\n\n    if (!this.retry) {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'Expected this.retry to exist.');\n    }\n\n    var backOffFactor = this.retry.backOffFactor || 0;\n    var delayInSeconds = Math.pow(2, retryAttempts) * backOffFactor;\n    return Math.min(delayInSeconds * 1000, this.retry.maxDelayInMillis);\n  };\n\n  return HttpClient;\n}();\n\nexports.HttpClient = HttpClient;\n/**\n * Parses a full HTTP response message containing both a header and a body.\n *\n * @param {string|Buffer} response The HTTP response to be parsed.\n * @param {HttpRequestConfig} config The request configuration that resulted in the HTTP response.\n * @return {HttpResponse} An object containing the parsed HTTP status, headers and the body.\n */\n\nfunction parseHttpResponse(response, config) {\n  var responseText = validator.isBuffer(response) ? response.toString('utf-8') : response;\n  var endOfHeaderPos = responseText.indexOf('\\r\\n\\r\\n');\n  var headerLines = responseText.substring(0, endOfHeaderPos).split('\\r\\n');\n  var statusLine = headerLines[0];\n  var status = statusLine.trim().split(/\\s/)[1];\n  var headers = {};\n  headerLines.slice(1).forEach(function (line) {\n    var colonPos = line.indexOf(':');\n    var name = line.substring(0, colonPos).trim().toLowerCase();\n    var value = line.substring(colonPos + 1).trim();\n    headers[name] = value;\n  });\n  var data = responseText.substring(endOfHeaderPos + 4);\n\n  if (data.endsWith('\\n')) {\n    data = data.slice(0, -1);\n  }\n\n  if (data.endsWith('\\r')) {\n    data = data.slice(0, -1);\n  }\n\n  var lowLevelResponse = {\n    status: parseInt(status, 10),\n    headers: headers,\n    data: data,\n    config: config,\n    request: null\n  };\n\n  if (!validator.isNumber(lowLevelResponse.status)) {\n    throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'Malformed HTTP status line.');\n  }\n\n  return new DefaultHttpResponse(lowLevelResponse);\n}\n\nexports.parseHttpResponse = parseHttpResponse;\n/**\n * A helper class for sending HTTP requests over the wire. This is a wrapper around the standard\n * http and https packages of Node.js, providing content processing, timeouts and error handling.\n * It also wraps the callback API of the Node.js standard library in a more flexible Promise API.\n */\n\nvar AsyncHttpCall =\n/** @class */\nfunction () {\n  function AsyncHttpCall(config) {\n    var _this = this;\n\n    try {\n      this.config = new HttpRequestConfigImpl(config);\n      this.options = this.config.buildRequestOptions();\n      this.entity = this.config.buildEntity(this.options.headers);\n      this.promise = new Promise(function (resolve, reject) {\n        _this.resolve = resolve;\n        _this.reject = reject;\n\n        _this.execute();\n      });\n    } catch (err) {\n      this.promise = Promise.reject(this.enhanceError(err, null));\n    }\n  }\n  /**\n   * Sends an HTTP request based on the provided configuration.\n   */\n\n\n  AsyncHttpCall.invoke = function (config) {\n    return new AsyncHttpCall(config).promise;\n  };\n\n  AsyncHttpCall.prototype.execute = function () {\n    var _this = this;\n\n    var transport = this.options.protocol === 'https:' ? https : http;\n    var req = transport.request(this.options, function (res) {\n      _this.handleResponse(res, req);\n    }); // Handle errors\n\n    req.on('error', function (err) {\n      if (req.aborted) {\n        return;\n      }\n\n      _this.enhanceAndReject(err, null, req);\n    });\n    var timeout = this.config.timeout;\n\n    var timeoutCallback = function () {\n      req.abort();\n\n      _this.rejectWithError(\"timeout of \" + timeout + \"ms exceeded\", 'ETIMEDOUT', req);\n    };\n\n    if (timeout) {\n      // Listen to timeouts and throw an error.\n      req.setTimeout(timeout, timeoutCallback);\n      req.on('socket', function (socket) {\n        socket.setTimeout(timeout, timeoutCallback);\n      });\n    } // Send the request\n\n\n    req.end(this.entity);\n  };\n\n  AsyncHttpCall.prototype.handleResponse = function (res, req) {\n    if (req.aborted) {\n      return;\n    }\n\n    if (!res.statusCode) {\n      throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'Expected a statusCode on the response from a ClientRequest');\n    }\n\n    var response = {\n      status: res.statusCode,\n      headers: res.headers,\n      request: req,\n      data: undefined,\n      config: this.config\n    };\n    var boundary = this.getMultipartBoundary(res.headers);\n    var respStream = this.uncompressResponse(res);\n\n    if (boundary) {\n      this.handleMultipartResponse(response, respStream, boundary);\n    } else {\n      this.handleRegularResponse(response, respStream);\n    }\n  };\n  /**\n   * Extracts multipart boundary from the HTTP header. The content-type header of a multipart\n   * response has the form 'multipart/subtype; boundary=string'.\n   *\n   * If the content-type header does not exist, or does not start with\n   * 'multipart/', then null will be returned.\n   */\n\n\n  AsyncHttpCall.prototype.getMultipartBoundary = function (headers) {\n    var contentType = headers['content-type'];\n\n    if (!contentType || !contentType.startsWith('multipart/')) {\n      return null;\n    }\n\n    var segments = contentType.split(';');\n    var emptyObject = {};\n    var headerParams = segments.slice(1).map(function (segment) {\n      return segment.trim().split('=');\n    }).reduce(function (curr, params) {\n      // Parse key=value pairs in the content-type header into properties of an object.\n      if (params.length === 2) {\n        var keyValuePair = {};\n        keyValuePair[params[0]] = params[1];\n        return Object.assign(curr, keyValuePair);\n      }\n\n      return curr;\n    }, emptyObject);\n    return headerParams.boundary;\n  };\n\n  AsyncHttpCall.prototype.uncompressResponse = function (res) {\n    // Uncompress the response body transparently if required.\n    var respStream = res;\n    var encodings = ['gzip', 'compress', 'deflate'];\n\n    if (res.headers['content-encoding'] && encodings.indexOf(res.headers['content-encoding']) !== -1) {\n      // Add the unzipper to the body stream processing pipeline.\n      var zlib = require('zlib'); // eslint-disable-line @typescript-eslint/no-var-requires\n\n\n      respStream = respStream.pipe(zlib.createUnzip()); // Remove the content-encoding in order to not confuse downstream operations.\n\n      delete res.headers['content-encoding'];\n    }\n\n    return respStream;\n  };\n\n  AsyncHttpCall.prototype.handleMultipartResponse = function (response, respStream, boundary) {\n    var _this = this;\n\n    var dicer = require('dicer'); // eslint-disable-line @typescript-eslint/no-var-requires\n\n\n    var multipartParser = new dicer({\n      boundary: boundary\n    });\n    var responseBuffer = [];\n    multipartParser.on('part', function (part) {\n      var tempBuffers = [];\n      part.on('data', function (partData) {\n        tempBuffers.push(partData);\n      });\n      part.on('end', function () {\n        responseBuffer.push(Buffer.concat(tempBuffers));\n      });\n    });\n    multipartParser.on('finish', function () {\n      response.data = undefined;\n      response.multipart = responseBuffer;\n\n      _this.finalizeResponse(response);\n    });\n    respStream.pipe(multipartParser);\n  };\n\n  AsyncHttpCall.prototype.handleRegularResponse = function (response, respStream) {\n    var _this = this;\n\n    var responseBuffer = [];\n    respStream.on('data', function (chunk) {\n      responseBuffer.push(chunk);\n    });\n    respStream.on('error', function (err) {\n      var req = response.request;\n\n      if (req && req.aborted) {\n        return;\n      }\n\n      _this.enhanceAndReject(err, null, req);\n    });\n    respStream.on('end', function () {\n      response.data = Buffer.concat(responseBuffer).toString();\n\n      _this.finalizeResponse(response);\n    });\n  };\n  /**\n   * Finalizes the current HTTP call in-flight by either resolving or rejecting the associated\n   * promise. In the event of an error, adds additional useful information to the returned error.\n   */\n\n\n  AsyncHttpCall.prototype.finalizeResponse = function (response) {\n    if (response.status >= 200 && response.status < 300) {\n      this.resolve(response);\n    } else {\n      this.rejectWithError('Request failed with status code ' + response.status, null, response.request, response);\n    }\n  };\n  /**\n   * Creates a new error from the given message, and enhances it with other information available.\n   * Then the promise associated with this HTTP call is rejected with the resulting error.\n   */\n\n\n  AsyncHttpCall.prototype.rejectWithError = function (message, code, request, response) {\n    var error = new Error(message);\n    this.enhanceAndReject(error, code, request, response);\n  };\n\n  AsyncHttpCall.prototype.enhanceAndReject = function (error, code, request, response) {\n    this.reject(this.enhanceError(error, code, request, response));\n  };\n  /**\n   * Enhances the given error by adding more information to it. Specifically, the HttpRequestConfig,\n   * the underlying request and response will be attached to the error.\n   */\n\n\n  AsyncHttpCall.prototype.enhanceError = function (error, code, request, response) {\n    error.config = this.config;\n\n    if (code) {\n      error.code = code;\n    }\n\n    error.request = request;\n    error.response = response;\n    return error;\n  };\n\n  return AsyncHttpCall;\n}();\n/**\n * An adapter class for extracting options and entity data from an HttpRequestConfig.\n */\n\n\nvar HttpRequestConfigImpl =\n/** @class */\nfunction () {\n  function HttpRequestConfigImpl(config) {\n    this.config = config;\n  }\n\n  Object.defineProperty(HttpRequestConfigImpl.prototype, \"method\", {\n    get: function () {\n      return this.config.method;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(HttpRequestConfigImpl.prototype, \"url\", {\n    get: function () {\n      return this.config.url;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(HttpRequestConfigImpl.prototype, \"headers\", {\n    get: function () {\n      return this.config.headers;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(HttpRequestConfigImpl.prototype, \"data\", {\n    get: function () {\n      return this.config.data;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(HttpRequestConfigImpl.prototype, \"timeout\", {\n    get: function () {\n      return this.config.timeout;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(HttpRequestConfigImpl.prototype, \"httpAgent\", {\n    get: function () {\n      return this.config.httpAgent;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  HttpRequestConfigImpl.prototype.buildRequestOptions = function () {\n    var parsed = this.buildUrl();\n    var protocol = parsed.protocol;\n    var port = parsed.port;\n\n    if (!port) {\n      var isHttps = protocol === 'https:';\n      port = isHttps ? '443' : '80';\n    }\n\n    return {\n      protocol: protocol,\n      hostname: parsed.hostname,\n      port: port,\n      path: parsed.path,\n      method: this.method,\n      agent: this.httpAgent,\n      headers: Object.assign({}, this.headers)\n    };\n  };\n\n  HttpRequestConfigImpl.prototype.buildEntity = function (headers) {\n    var data;\n\n    if (!this.hasEntity() || !this.isEntityEnclosingRequest()) {\n      return data;\n    }\n\n    if (validator.isBuffer(this.data)) {\n      data = this.data;\n    } else if (validator.isObject(this.data)) {\n      data = Buffer.from(JSON.stringify(this.data), 'utf-8');\n\n      if (typeof headers['content-type'] === 'undefined') {\n        headers['content-type'] = 'application/json;charset=utf-8';\n      }\n    } else if (validator.isString(this.data)) {\n      data = Buffer.from(this.data, 'utf-8');\n    } else {\n      throw new Error('Request data must be a string, a Buffer or a json serializable object');\n    } // Add Content-Length header if data exists.\n\n\n    headers['Content-Length'] = data.length.toString();\n    return data;\n  };\n\n  HttpRequestConfigImpl.prototype.buildUrl = function () {\n    var fullUrl = this.urlWithProtocol();\n\n    if (!this.hasEntity() || this.isEntityEnclosingRequest()) {\n      return url.parse(fullUrl);\n    }\n\n    if (!validator.isObject(this.data)) {\n      throw new Error(this.method + \" requests cannot have a body\");\n    } // Parse URL and append data to query string.\n\n\n    var parsedUrl = new url.URL(fullUrl);\n    var dataObj = this.data;\n\n    for (var key in dataObj) {\n      if (Object.prototype.hasOwnProperty.call(dataObj, key)) {\n        parsedUrl.searchParams.append(key, dataObj[key]);\n      }\n    }\n\n    return url.parse(parsedUrl.toString());\n  };\n\n  HttpRequestConfigImpl.prototype.urlWithProtocol = function () {\n    var fullUrl = this.url;\n\n    if (fullUrl.startsWith('http://') || fullUrl.startsWith('https://')) {\n      return fullUrl;\n    }\n\n    return \"https://\" + fullUrl;\n  };\n\n  HttpRequestConfigImpl.prototype.hasEntity = function () {\n    return !!this.data;\n  };\n\n  HttpRequestConfigImpl.prototype.isEntityEnclosingRequest = function () {\n    // GET and HEAD requests do not support entity (body) in request.\n    return this.method !== 'GET' && this.method !== 'HEAD';\n  };\n\n  return HttpRequestConfigImpl;\n}();\n\nvar AuthorizedHttpClient =\n/** @class */\nfunction (_super) {\n  __extends(AuthorizedHttpClient, _super);\n\n  function AuthorizedHttpClient(app) {\n    var _this = _super.call(this) || this;\n\n    _this.app = app;\n    return _this;\n  }\n\n  AuthorizedHttpClient.prototype.send = function (request) {\n    var _this = this;\n\n    return this.getToken().then(function (token) {\n      var requestCopy = Object.assign({}, request);\n      requestCopy.headers = Object.assign({}, request.headers);\n      var authHeader = 'Authorization';\n      requestCopy.headers[authHeader] = \"Bearer \" + token;\n\n      if (!requestCopy.httpAgent && _this.app.options.httpAgent) {\n        requestCopy.httpAgent = _this.app.options.httpAgent;\n      }\n\n      return _super.prototype.send.call(_this, requestCopy);\n    });\n  };\n\n  AuthorizedHttpClient.prototype.getToken = function () {\n    return this.app.INTERNAL.getToken().then(function (accessTokenObj) {\n      return accessTokenObj.accessToken;\n    });\n  };\n\n  return AuthorizedHttpClient;\n}(HttpClient);\n\nexports.AuthorizedHttpClient = AuthorizedHttpClient;\n/**\n * Class that defines all the settings for the backend API endpoint.\n *\n * @param {string} endpoint The Firebase Auth backend endpoint.\n * @param {HttpMethod} httpMethod The http method for that endpoint.\n * @constructor\n */\n\nvar ApiSettings =\n/** @class */\nfunction () {\n  function ApiSettings(endpoint, httpMethod) {\n    if (httpMethod === void 0) {\n      httpMethod = 'POST';\n    }\n\n    this.endpoint = endpoint;\n    this.httpMethod = httpMethod;\n    this.setRequestValidator(null).setResponseValidator(null);\n  }\n  /** @return {string} The backend API endpoint. */\n\n\n  ApiSettings.prototype.getEndpoint = function () {\n    return this.endpoint;\n  };\n  /** @return {HttpMethod} The request HTTP method. */\n\n\n  ApiSettings.prototype.getHttpMethod = function () {\n    return this.httpMethod;\n  };\n  /**\n   * @param {ApiCallbackFunction} requestValidator The request validator.\n   * @return {ApiSettings} The current API settings instance.\n   */\n\n\n  ApiSettings.prototype.setRequestValidator = function (requestValidator) {\n    var nullFunction = function () {\n      return undefined;\n    };\n\n    this.requestValidator = requestValidator || nullFunction;\n    return this;\n  };\n  /** @return {ApiCallbackFunction} The request validator. */\n\n\n  ApiSettings.prototype.getRequestValidator = function () {\n    return this.requestValidator;\n  };\n  /**\n   * @param {ApiCallbackFunction} responseValidator The response validator.\n   * @return {ApiSettings} The current API settings instance.\n   */\n\n\n  ApiSettings.prototype.setResponseValidator = function (responseValidator) {\n    var nullFunction = function () {\n      return undefined;\n    };\n\n    this.responseValidator = responseValidator || nullFunction;\n    return this;\n  };\n  /** @return {ApiCallbackFunction} The response validator. */\n\n\n  ApiSettings.prototype.getResponseValidator = function () {\n    return this.responseValidator;\n  };\n\n  return ApiSettings;\n}();\n\nexports.ApiSettings = ApiSettings;\n/**\n * Class used for polling an endpoint with exponential backoff.\n *\n * Example usage:\n * ```\n * const poller = new ExponentialBackoffPoller();\n * poller\n *     .poll(() => {\n *       return myRequestToPoll()\n *           .then((responseData: any) => {\n *             if (!isValid(responseData)) {\n *               // Continue polling.\n *               return null;\n *             }\n *\n *             // Polling complete. Resolve promise with final response data.\n *             return responseData;\n *           });\n *     })\n *     .then((responseData: any) => {\n *       console.log(`Final response: ${responseData}`);\n *     });\n * ```\n */\n\nvar ExponentialBackoffPoller =\n/** @class */\nfunction (_super) {\n  __extends(ExponentialBackoffPoller, _super);\n\n  function ExponentialBackoffPoller(initialPollingDelayMillis, maxPollingDelayMillis, masterTimeoutMillis) {\n    if (initialPollingDelayMillis === void 0) {\n      initialPollingDelayMillis = 1000;\n    }\n\n    if (maxPollingDelayMillis === void 0) {\n      maxPollingDelayMillis = 10000;\n    }\n\n    if (masterTimeoutMillis === void 0) {\n      masterTimeoutMillis = 60000;\n    }\n\n    var _this = _super.call(this) || this;\n\n    _this.initialPollingDelayMillis = initialPollingDelayMillis;\n    _this.maxPollingDelayMillis = maxPollingDelayMillis;\n    _this.masterTimeoutMillis = masterTimeoutMillis;\n    _this.numTries = 0;\n    _this.completed = false;\n    return _this;\n  }\n  /**\n   * Poll the provided callback with exponential backoff.\n   *\n   * @param {() => Promise<T>} callback The callback to be called for each poll. If the\n   *     callback resolves to a falsey value, polling will continue. Otherwise, the truthy\n   *     resolution will be used to resolve the promise returned by this method.\n   * @return {Promise<T>} A Promise which resolves to the truthy value returned by the provided\n   *     callback when polling is complete.\n   */\n\n\n  ExponentialBackoffPoller.prototype.poll = function (callback) {\n    var _this = this;\n\n    if (this.pollCallback) {\n      throw new Error('poll() can only be called once per instance of ExponentialBackoffPoller');\n    }\n\n    this.pollCallback = callback;\n    this.on('poll', this.repoll);\n    this.masterTimer = setTimeout(function () {\n      if (_this.completed) {\n        return;\n      }\n\n      _this.markCompleted();\n\n      _this.reject(new Error('ExponentialBackoffPoller deadline exceeded - Master timeout reached'));\n    }, this.masterTimeoutMillis);\n    return new Promise(function (resolve, reject) {\n      _this.resolve = resolve;\n      _this.reject = reject;\n\n      _this.repoll();\n    });\n  };\n\n  ExponentialBackoffPoller.prototype.repoll = function () {\n    var _this = this;\n\n    this.pollCallback().then(function (result) {\n      if (_this.completed) {\n        return;\n      }\n\n      if (!result) {\n        _this.repollTimer = setTimeout(function () {\n          return _this.emit('poll');\n        }, _this.getPollingDelayMillis());\n        _this.numTries++;\n        return;\n      }\n\n      _this.markCompleted();\n\n      _this.resolve(result);\n    }).catch(function (err) {\n      if (_this.completed) {\n        return;\n      }\n\n      _this.markCompleted();\n\n      _this.reject(err);\n    });\n  };\n\n  ExponentialBackoffPoller.prototype.getPollingDelayMillis = function () {\n    var increasedPollingDelay = Math.pow(2, this.numTries) * this.initialPollingDelayMillis;\n    return Math.min(increasedPollingDelay, this.maxPollingDelayMillis);\n  };\n\n  ExponentialBackoffPoller.prototype.markCompleted = function () {\n    this.completed = true;\n\n    if (this.masterTimer) {\n      clearTimeout(this.masterTimer);\n    }\n\n    if (this.repollTimer) {\n      clearTimeout(this.repollTimer);\n    }\n  };\n\n  return ExponentialBackoffPoller;\n}(events_1.EventEmitter);\n\nexports.ExponentialBackoffPoller = ExponentialBackoffPoller;","map":{"version":3,"sources":["/Users/pulkitmittal/nft-bridge/NFTbridge/node_modules/firebase-admin/lib/utils/api-request.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","exports","value","ExponentialBackoffPoller","ApiSettings","AuthorizedHttpClient","parseHttpResponse","HttpClient","defaultRetryConfig","HttpError","error_1","require","validator","http","https","url","events_1","DefaultHttpResponse","resp","status","headers","text","data","FirebaseAppError","AppErrorCodes","INTERNAL_ERROR","parsedData","JSON","parse","err","undefined","parseError","request","config","method","get","isJson","UNABLE_TO_PARSE_RESPONSE","toString","enumerable","configurable","MultipartHttpResponse","multipart","_super","response","_this","call","Error","maxRetries","statusCodes","ioErrorCodes","backOffFactor","maxDelayInMillis","validateRetryConfig","retry","isNumber","INVALID_ARGUMENT","isArray","send","sendWithRetry","retryAttempts","AsyncHttpCall","invoke","then","createHttpResponse","catch","_a","getRetryDelayMillis","delayMillis","canRetry","waitForRetry","code","NETWORK_TIMEOUT","message","NETWORK_ERROR","Promise","resolve","setTimeout","isRetryEligible","parseRetryAfterIntoMillis","backOffDelayMillis","indexOf","retryCodes","retryAfter","delaySeconds","parseInt","isNaN","date","Date","getTime","now","delayInSeconds","Math","pow","min","responseText","isBuffer","endOfHeaderPos","headerLines","substring","split","statusLine","trim","slice","forEach","line","colonPos","name","toLowerCase","endsWith","lowLevelResponse","HttpRequestConfigImpl","options","buildRequestOptions","entity","buildEntity","promise","reject","execute","enhanceError","transport","protocol","req","res","handleResponse","on","aborted","enhanceAndReject","timeout","timeoutCallback","abort","rejectWithError","socket","end","statusCode","boundary","getMultipartBoundary","respStream","uncompressResponse","handleMultipartResponse","handleRegularResponse","contentType","startsWith","segments","emptyObject","headerParams","map","segment","reduce","curr","params","length","keyValuePair","assign","encodings","zlib","pipe","createUnzip","dicer","multipartParser","responseBuffer","part","tempBuffers","partData","push","Buffer","concat","finalizeResponse","chunk","error","httpAgent","parsed","buildUrl","port","isHttps","hostname","path","agent","hasEntity","isEntityEnclosingRequest","isObject","from","stringify","isString","fullUrl","urlWithProtocol","parsedUrl","URL","dataObj","key","searchParams","append","app","getToken","token","requestCopy","authHeader","INTERNAL","accessTokenObj","accessToken","endpoint","httpMethod","setRequestValidator","setResponseValidator","getEndpoint","getHttpMethod","requestValidator","nullFunction","getRequestValidator","responseValidator","getResponseValidator","initialPollingDelayMillis","maxPollingDelayMillis","masterTimeoutMillis","numTries","completed","poll","callback","pollCallback","repoll","masterTimer","markCompleted","result","repollTimer","emit","getPollingDelayMillis","increasedPollingDelay","clearTimeout","EventEmitter"],"mappings":"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","sourcesContent":["/*! firebase-admin v9.6.0 */\n\"use strict\";\n/*!\n * @license\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ExponentialBackoffPoller = exports.ApiSettings = exports.AuthorizedHttpClient = exports.parseHttpResponse = exports.HttpClient = exports.defaultRetryConfig = exports.HttpError = void 0;\nvar error_1 = require(\"./error\");\nvar validator = require(\"./validator\");\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar url = require(\"url\");\nvar events_1 = require(\"events\");\nvar DefaultHttpResponse = /** @class */ (function () {\n    /**\n     * Constructs a new HttpResponse from the given LowLevelResponse.\n     */\n    function DefaultHttpResponse(resp) {\n        this.status = resp.status;\n        this.headers = resp.headers;\n        this.text = resp.data;\n        try {\n            if (!resp.data) {\n                throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'HTTP response missing data.');\n            }\n            this.parsedData = JSON.parse(resp.data);\n        }\n        catch (err) {\n            this.parsedData = undefined;\n            this.parseError = err;\n        }\n        this.request = resp.config.method + \" \" + resp.config.url;\n    }\n    Object.defineProperty(DefaultHttpResponse.prototype, \"data\", {\n        get: function () {\n            if (this.isJson()) {\n                return this.parsedData;\n            }\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.UNABLE_TO_PARSE_RESPONSE, \"Error while parsing response data: \\\"\" + this.parseError.toString() + \"\\\". Raw server \" +\n                (\"response: \\\"\" + this.text + \"\\\". Status code: \\\"\" + this.status + \"\\\". Outgoing \") +\n                (\"request: \\\"\" + this.request + \".\\\"\"));\n        },\n        enumerable: false,\n        configurable: true\n    });\n    DefaultHttpResponse.prototype.isJson = function () {\n        return typeof this.parsedData !== 'undefined';\n    };\n    return DefaultHttpResponse;\n}());\n/**\n * Represents a multipart HTTP response. Parts that constitute the response body can be accessed\n * via the multipart getter. Getters for text and data throw errors.\n */\nvar MultipartHttpResponse = /** @class */ (function () {\n    function MultipartHttpResponse(resp) {\n        this.status = resp.status;\n        this.headers = resp.headers;\n        this.multipart = resp.multipart;\n    }\n    Object.defineProperty(MultipartHttpResponse.prototype, \"text\", {\n        get: function () {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.UNABLE_TO_PARSE_RESPONSE, 'Unable to parse multipart payload as text');\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(MultipartHttpResponse.prototype, \"data\", {\n        get: function () {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.UNABLE_TO_PARSE_RESPONSE, 'Unable to parse multipart payload as JSON');\n        },\n        enumerable: false,\n        configurable: true\n    });\n    MultipartHttpResponse.prototype.isJson = function () {\n        return false;\n    };\n    return MultipartHttpResponse;\n}());\nvar HttpError = /** @class */ (function (_super) {\n    __extends(HttpError, _super);\n    function HttpError(response) {\n        var _this = _super.call(this, \"Server responded with status \" + response.status + \".\") || this;\n        _this.response = response;\n        // Set the prototype so that instanceof checks will work correctly.\n        // See: https://github.com/Microsoft/TypeScript/issues/13965\n        Object.setPrototypeOf(_this, HttpError.prototype);\n        return _this;\n    }\n    return HttpError;\n}(Error));\nexports.HttpError = HttpError;\n/**\n * Default retry configuration for HTTP requests. Retries up to 4 times on connection reset and timeout errors\n * as well as HTTP 503 errors. Exposed as a function to ensure that every HttpClient gets its own RetryConfig\n * instance.\n */\nfunction defaultRetryConfig() {\n    return {\n        maxRetries: 4,\n        statusCodes: [503],\n        ioErrorCodes: ['ECONNRESET', 'ETIMEDOUT'],\n        backOffFactor: 0.5,\n        maxDelayInMillis: 60 * 1000,\n    };\n}\nexports.defaultRetryConfig = defaultRetryConfig;\n/**\n * Ensures that the given RetryConfig object is valid.\n *\n * @param retry The configuration to be validated.\n */\nfunction validateRetryConfig(retry) {\n    if (!validator.isNumber(retry.maxRetries) || retry.maxRetries < 0) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'maxRetries must be a non-negative integer');\n    }\n    if (typeof retry.backOffFactor !== 'undefined') {\n        if (!validator.isNumber(retry.backOffFactor) || retry.backOffFactor < 0) {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'backOffFactor must be a non-negative number');\n        }\n    }\n    if (!validator.isNumber(retry.maxDelayInMillis) || retry.maxDelayInMillis < 0) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'maxDelayInMillis must be a non-negative integer');\n    }\n    if (typeof retry.statusCodes !== 'undefined' && !validator.isArray(retry.statusCodes)) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'statusCodes must be an array');\n    }\n    if (typeof retry.ioErrorCodes !== 'undefined' && !validator.isArray(retry.ioErrorCodes)) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INVALID_ARGUMENT, 'ioErrorCodes must be an array');\n    }\n}\nvar HttpClient = /** @class */ (function () {\n    function HttpClient(retry) {\n        if (retry === void 0) { retry = defaultRetryConfig(); }\n        this.retry = retry;\n        if (this.retry) {\n            validateRetryConfig(this.retry);\n        }\n    }\n    /**\n     * Sends an HTTP request to a remote server. If the server responds with a successful response (2xx), the returned\n     * promise resolves with an HttpResponse. If the server responds with an error (3xx, 4xx, 5xx), the promise rejects\n     * with an HttpError. In case of all other errors, the promise rejects with a FirebaseAppError. If a request fails\n     * due to a low-level network error, transparently retries the request once before rejecting the promise.\n     *\n     * If the request data is specified as an object, it will be serialized into a JSON string. The application/json\n     * content-type header will also be automatically set in this case. For all other payload types, the content-type\n     * header should be explicitly set by the caller. To send a JSON leaf value (e.g. \"foo\", 5), parse it into JSON,\n     * and pass as a string or a Buffer along with the appropriate content-type header.\n     *\n     * @param {HttpRequest} config HTTP request to be sent.\n     * @return {Promise<HttpResponse>} A promise that resolves with the response details.\n     */\n    HttpClient.prototype.send = function (config) {\n        return this.sendWithRetry(config);\n    };\n    /**\n     * Sends an HTTP request. In the event of an error, retries the HTTP request according to the\n     * RetryConfig set on the HttpClient.\n     *\n     * @param {HttpRequestConfig} config HTTP request to be sent.\n     * @param {number} retryAttempts Number of retries performed up to now.\n     * @return {Promise<HttpResponse>} A promise that resolves with the response details.\n     */\n    HttpClient.prototype.sendWithRetry = function (config, retryAttempts) {\n        var _this = this;\n        if (retryAttempts === void 0) { retryAttempts = 0; }\n        return AsyncHttpCall.invoke(config)\n            .then(function (resp) {\n            return _this.createHttpResponse(resp);\n        })\n            .catch(function (err) {\n            var _a = _this.getRetryDelayMillis(retryAttempts, err), delayMillis = _a[0], canRetry = _a[1];\n            if (canRetry && _this.retry && delayMillis <= _this.retry.maxDelayInMillis) {\n                return _this.waitForRetry(delayMillis).then(function () {\n                    return _this.sendWithRetry(config, retryAttempts + 1);\n                });\n            }\n            if (err.response) {\n                throw new HttpError(_this.createHttpResponse(err.response));\n            }\n            if (err.code === 'ETIMEDOUT') {\n                throw new error_1.FirebaseAppError(error_1.AppErrorCodes.NETWORK_TIMEOUT, \"Error while making request: \" + err.message + \".\");\n            }\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.NETWORK_ERROR, \"Error while making request: \" + err.message + \". Error code: \" + err.code);\n        });\n    };\n    HttpClient.prototype.createHttpResponse = function (resp) {\n        if (resp.multipart) {\n            return new MultipartHttpResponse(resp);\n        }\n        return new DefaultHttpResponse(resp);\n    };\n    HttpClient.prototype.waitForRetry = function (delayMillis) {\n        if (delayMillis > 0) {\n            return new Promise(function (resolve) {\n                setTimeout(resolve, delayMillis);\n            });\n        }\n        return Promise.resolve();\n    };\n    /**\n     * Checks if a failed request is eligible for a retry, and if so returns the duration to wait before initiating\n     * the retry.\n     *\n     * @param {number} retryAttempts Number of retries completed up to now.\n     * @param {LowLevelError} err The last encountered error.\n     * @returns {[number, boolean]} A 2-tuple where the 1st element is the duration to wait before another retry, and the\n     *     2nd element is a boolean indicating whether the request is eligible for a retry or not.\n     */\n    HttpClient.prototype.getRetryDelayMillis = function (retryAttempts, err) {\n        if (!this.isRetryEligible(retryAttempts, err)) {\n            return [0, false];\n        }\n        var response = err.response;\n        if (response && response.headers['retry-after']) {\n            var delayMillis = this.parseRetryAfterIntoMillis(response.headers['retry-after']);\n            if (delayMillis > 0) {\n                return [delayMillis, true];\n            }\n        }\n        return [this.backOffDelayMillis(retryAttempts), true];\n    };\n    HttpClient.prototype.isRetryEligible = function (retryAttempts, err) {\n        if (!this.retry) {\n            return false;\n        }\n        if (retryAttempts >= this.retry.maxRetries) {\n            return false;\n        }\n        if (err.response) {\n            var statusCodes = this.retry.statusCodes || [];\n            return statusCodes.indexOf(err.response.status) !== -1;\n        }\n        if (err.code) {\n            var retryCodes = this.retry.ioErrorCodes || [];\n            return retryCodes.indexOf(err.code) !== -1;\n        }\n        return false;\n    };\n    /**\n     * Parses the Retry-After HTTP header as a milliseconds value. Return value is negative if the Retry-After header\n     * contains an expired timestamp or otherwise malformed.\n     */\n    HttpClient.prototype.parseRetryAfterIntoMillis = function (retryAfter) {\n        var delaySeconds = parseInt(retryAfter, 10);\n        if (!isNaN(delaySeconds)) {\n            return delaySeconds * 1000;\n        }\n        var date = new Date(retryAfter);\n        if (!isNaN(date.getTime())) {\n            return date.getTime() - Date.now();\n        }\n        return -1;\n    };\n    HttpClient.prototype.backOffDelayMillis = function (retryAttempts) {\n        if (retryAttempts === 0) {\n            return 0;\n        }\n        if (!this.retry) {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'Expected this.retry to exist.');\n        }\n        var backOffFactor = this.retry.backOffFactor || 0;\n        var delayInSeconds = (Math.pow(2, retryAttempts)) * backOffFactor;\n        return Math.min(delayInSeconds * 1000, this.retry.maxDelayInMillis);\n    };\n    return HttpClient;\n}());\nexports.HttpClient = HttpClient;\n/**\n * Parses a full HTTP response message containing both a header and a body.\n *\n * @param {string|Buffer} response The HTTP response to be parsed.\n * @param {HttpRequestConfig} config The request configuration that resulted in the HTTP response.\n * @return {HttpResponse} An object containing the parsed HTTP status, headers and the body.\n */\nfunction parseHttpResponse(response, config) {\n    var responseText = validator.isBuffer(response) ?\n        response.toString('utf-8') : response;\n    var endOfHeaderPos = responseText.indexOf('\\r\\n\\r\\n');\n    var headerLines = responseText.substring(0, endOfHeaderPos).split('\\r\\n');\n    var statusLine = headerLines[0];\n    var status = statusLine.trim().split(/\\s/)[1];\n    var headers = {};\n    headerLines.slice(1).forEach(function (line) {\n        var colonPos = line.indexOf(':');\n        var name = line.substring(0, colonPos).trim().toLowerCase();\n        var value = line.substring(colonPos + 1).trim();\n        headers[name] = value;\n    });\n    var data = responseText.substring(endOfHeaderPos + 4);\n    if (data.endsWith('\\n')) {\n        data = data.slice(0, -1);\n    }\n    if (data.endsWith('\\r')) {\n        data = data.slice(0, -1);\n    }\n    var lowLevelResponse = {\n        status: parseInt(status, 10),\n        headers: headers,\n        data: data,\n        config: config,\n        request: null,\n    };\n    if (!validator.isNumber(lowLevelResponse.status)) {\n        throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'Malformed HTTP status line.');\n    }\n    return new DefaultHttpResponse(lowLevelResponse);\n}\nexports.parseHttpResponse = parseHttpResponse;\n/**\n * A helper class for sending HTTP requests over the wire. This is a wrapper around the standard\n * http and https packages of Node.js, providing content processing, timeouts and error handling.\n * It also wraps the callback API of the Node.js standard library in a more flexible Promise API.\n */\nvar AsyncHttpCall = /** @class */ (function () {\n    function AsyncHttpCall(config) {\n        var _this = this;\n        try {\n            this.config = new HttpRequestConfigImpl(config);\n            this.options = this.config.buildRequestOptions();\n            this.entity = this.config.buildEntity(this.options.headers);\n            this.promise = new Promise(function (resolve, reject) {\n                _this.resolve = resolve;\n                _this.reject = reject;\n                _this.execute();\n            });\n        }\n        catch (err) {\n            this.promise = Promise.reject(this.enhanceError(err, null));\n        }\n    }\n    /**\n     * Sends an HTTP request based on the provided configuration.\n     */\n    AsyncHttpCall.invoke = function (config) {\n        return new AsyncHttpCall(config).promise;\n    };\n    AsyncHttpCall.prototype.execute = function () {\n        var _this = this;\n        var transport = this.options.protocol === 'https:' ? https : http;\n        var req = transport.request(this.options, function (res) {\n            _this.handleResponse(res, req);\n        });\n        // Handle errors\n        req.on('error', function (err) {\n            if (req.aborted) {\n                return;\n            }\n            _this.enhanceAndReject(err, null, req);\n        });\n        var timeout = this.config.timeout;\n        var timeoutCallback = function () {\n            req.abort();\n            _this.rejectWithError(\"timeout of \" + timeout + \"ms exceeded\", 'ETIMEDOUT', req);\n        };\n        if (timeout) {\n            // Listen to timeouts and throw an error.\n            req.setTimeout(timeout, timeoutCallback);\n            req.on('socket', function (socket) {\n                socket.setTimeout(timeout, timeoutCallback);\n            });\n        }\n        // Send the request\n        req.end(this.entity);\n    };\n    AsyncHttpCall.prototype.handleResponse = function (res, req) {\n        if (req.aborted) {\n            return;\n        }\n        if (!res.statusCode) {\n            throw new error_1.FirebaseAppError(error_1.AppErrorCodes.INTERNAL_ERROR, 'Expected a statusCode on the response from a ClientRequest');\n        }\n        var response = {\n            status: res.statusCode,\n            headers: res.headers,\n            request: req,\n            data: undefined,\n            config: this.config,\n        };\n        var boundary = this.getMultipartBoundary(res.headers);\n        var respStream = this.uncompressResponse(res);\n        if (boundary) {\n            this.handleMultipartResponse(response, respStream, boundary);\n        }\n        else {\n            this.handleRegularResponse(response, respStream);\n        }\n    };\n    /**\n     * Extracts multipart boundary from the HTTP header. The content-type header of a multipart\n     * response has the form 'multipart/subtype; boundary=string'.\n     *\n     * If the content-type header does not exist, or does not start with\n     * 'multipart/', then null will be returned.\n     */\n    AsyncHttpCall.prototype.getMultipartBoundary = function (headers) {\n        var contentType = headers['content-type'];\n        if (!contentType || !contentType.startsWith('multipart/')) {\n            return null;\n        }\n        var segments = contentType.split(';');\n        var emptyObject = {};\n        var headerParams = segments.slice(1)\n            .map(function (segment) { return segment.trim().split('='); })\n            .reduce(function (curr, params) {\n            // Parse key=value pairs in the content-type header into properties of an object.\n            if (params.length === 2) {\n                var keyValuePair = {};\n                keyValuePair[params[0]] = params[1];\n                return Object.assign(curr, keyValuePair);\n            }\n            return curr;\n        }, emptyObject);\n        return headerParams.boundary;\n    };\n    AsyncHttpCall.prototype.uncompressResponse = function (res) {\n        // Uncompress the response body transparently if required.\n        var respStream = res;\n        var encodings = ['gzip', 'compress', 'deflate'];\n        if (res.headers['content-encoding'] && encodings.indexOf(res.headers['content-encoding']) !== -1) {\n            // Add the unzipper to the body stream processing pipeline.\n            var zlib = require('zlib'); // eslint-disable-line @typescript-eslint/no-var-requires\n            respStream = respStream.pipe(zlib.createUnzip());\n            // Remove the content-encoding in order to not confuse downstream operations.\n            delete res.headers['content-encoding'];\n        }\n        return respStream;\n    };\n    AsyncHttpCall.prototype.handleMultipartResponse = function (response, respStream, boundary) {\n        var _this = this;\n        var dicer = require('dicer'); // eslint-disable-line @typescript-eslint/no-var-requires\n        var multipartParser = new dicer({ boundary: boundary });\n        var responseBuffer = [];\n        multipartParser.on('part', function (part) {\n            var tempBuffers = [];\n            part.on('data', function (partData) {\n                tempBuffers.push(partData);\n            });\n            part.on('end', function () {\n                responseBuffer.push(Buffer.concat(tempBuffers));\n            });\n        });\n        multipartParser.on('finish', function () {\n            response.data = undefined;\n            response.multipart = responseBuffer;\n            _this.finalizeResponse(response);\n        });\n        respStream.pipe(multipartParser);\n    };\n    AsyncHttpCall.prototype.handleRegularResponse = function (response, respStream) {\n        var _this = this;\n        var responseBuffer = [];\n        respStream.on('data', function (chunk) {\n            responseBuffer.push(chunk);\n        });\n        respStream.on('error', function (err) {\n            var req = response.request;\n            if (req && req.aborted) {\n                return;\n            }\n            _this.enhanceAndReject(err, null, req);\n        });\n        respStream.on('end', function () {\n            response.data = Buffer.concat(responseBuffer).toString();\n            _this.finalizeResponse(response);\n        });\n    };\n    /**\n     * Finalizes the current HTTP call in-flight by either resolving or rejecting the associated\n     * promise. In the event of an error, adds additional useful information to the returned error.\n     */\n    AsyncHttpCall.prototype.finalizeResponse = function (response) {\n        if (response.status >= 200 && response.status < 300) {\n            this.resolve(response);\n        }\n        else {\n            this.rejectWithError('Request failed with status code ' + response.status, null, response.request, response);\n        }\n    };\n    /**\n     * Creates a new error from the given message, and enhances it with other information available.\n     * Then the promise associated with this HTTP call is rejected with the resulting error.\n     */\n    AsyncHttpCall.prototype.rejectWithError = function (message, code, request, response) {\n        var error = new Error(message);\n        this.enhanceAndReject(error, code, request, response);\n    };\n    AsyncHttpCall.prototype.enhanceAndReject = function (error, code, request, response) {\n        this.reject(this.enhanceError(error, code, request, response));\n    };\n    /**\n     * Enhances the given error by adding more information to it. Specifically, the HttpRequestConfig,\n     * the underlying request and response will be attached to the error.\n     */\n    AsyncHttpCall.prototype.enhanceError = function (error, code, request, response) {\n        error.config = this.config;\n        if (code) {\n            error.code = code;\n        }\n        error.request = request;\n        error.response = response;\n        return error;\n    };\n    return AsyncHttpCall;\n}());\n/**\n * An adapter class for extracting options and entity data from an HttpRequestConfig.\n */\nvar HttpRequestConfigImpl = /** @class */ (function () {\n    function HttpRequestConfigImpl(config) {\n        this.config = config;\n    }\n    Object.defineProperty(HttpRequestConfigImpl.prototype, \"method\", {\n        get: function () {\n            return this.config.method;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HttpRequestConfigImpl.prototype, \"url\", {\n        get: function () {\n            return this.config.url;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HttpRequestConfigImpl.prototype, \"headers\", {\n        get: function () {\n            return this.config.headers;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HttpRequestConfigImpl.prototype, \"data\", {\n        get: function () {\n            return this.config.data;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HttpRequestConfigImpl.prototype, \"timeout\", {\n        get: function () {\n            return this.config.timeout;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(HttpRequestConfigImpl.prototype, \"httpAgent\", {\n        get: function () {\n            return this.config.httpAgent;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    HttpRequestConfigImpl.prototype.buildRequestOptions = function () {\n        var parsed = this.buildUrl();\n        var protocol = parsed.protocol;\n        var port = parsed.port;\n        if (!port) {\n            var isHttps = protocol === 'https:';\n            port = isHttps ? '443' : '80';\n        }\n        return {\n            protocol: protocol,\n            hostname: parsed.hostname,\n            port: port,\n            path: parsed.path,\n            method: this.method,\n            agent: this.httpAgent,\n            headers: Object.assign({}, this.headers),\n        };\n    };\n    HttpRequestConfigImpl.prototype.buildEntity = function (headers) {\n        var data;\n        if (!this.hasEntity() || !this.isEntityEnclosingRequest()) {\n            return data;\n        }\n        if (validator.isBuffer(this.data)) {\n            data = this.data;\n        }\n        else if (validator.isObject(this.data)) {\n            data = Buffer.from(JSON.stringify(this.data), 'utf-8');\n            if (typeof headers['content-type'] === 'undefined') {\n                headers['content-type'] = 'application/json;charset=utf-8';\n            }\n        }\n        else if (validator.isString(this.data)) {\n            data = Buffer.from(this.data, 'utf-8');\n        }\n        else {\n            throw new Error('Request data must be a string, a Buffer or a json serializable object');\n        }\n        // Add Content-Length header if data exists.\n        headers['Content-Length'] = data.length.toString();\n        return data;\n    };\n    HttpRequestConfigImpl.prototype.buildUrl = function () {\n        var fullUrl = this.urlWithProtocol();\n        if (!this.hasEntity() || this.isEntityEnclosingRequest()) {\n            return url.parse(fullUrl);\n        }\n        if (!validator.isObject(this.data)) {\n            throw new Error(this.method + \" requests cannot have a body\");\n        }\n        // Parse URL and append data to query string.\n        var parsedUrl = new url.URL(fullUrl);\n        var dataObj = this.data;\n        for (var key in dataObj) {\n            if (Object.prototype.hasOwnProperty.call(dataObj, key)) {\n                parsedUrl.searchParams.append(key, dataObj[key]);\n            }\n        }\n        return url.parse(parsedUrl.toString());\n    };\n    HttpRequestConfigImpl.prototype.urlWithProtocol = function () {\n        var fullUrl = this.url;\n        if (fullUrl.startsWith('http://') || fullUrl.startsWith('https://')) {\n            return fullUrl;\n        }\n        return \"https://\" + fullUrl;\n    };\n    HttpRequestConfigImpl.prototype.hasEntity = function () {\n        return !!this.data;\n    };\n    HttpRequestConfigImpl.prototype.isEntityEnclosingRequest = function () {\n        // GET and HEAD requests do not support entity (body) in request.\n        return this.method !== 'GET' && this.method !== 'HEAD';\n    };\n    return HttpRequestConfigImpl;\n}());\nvar AuthorizedHttpClient = /** @class */ (function (_super) {\n    __extends(AuthorizedHttpClient, _super);\n    function AuthorizedHttpClient(app) {\n        var _this = _super.call(this) || this;\n        _this.app = app;\n        return _this;\n    }\n    AuthorizedHttpClient.prototype.send = function (request) {\n        var _this = this;\n        return this.getToken().then(function (token) {\n            var requestCopy = Object.assign({}, request);\n            requestCopy.headers = Object.assign({}, request.headers);\n            var authHeader = 'Authorization';\n            requestCopy.headers[authHeader] = \"Bearer \" + token;\n            if (!requestCopy.httpAgent && _this.app.options.httpAgent) {\n                requestCopy.httpAgent = _this.app.options.httpAgent;\n            }\n            return _super.prototype.send.call(_this, requestCopy);\n        });\n    };\n    AuthorizedHttpClient.prototype.getToken = function () {\n        return this.app.INTERNAL.getToken()\n            .then(function (accessTokenObj) {\n            return accessTokenObj.accessToken;\n        });\n    };\n    return AuthorizedHttpClient;\n}(HttpClient));\nexports.AuthorizedHttpClient = AuthorizedHttpClient;\n/**\n * Class that defines all the settings for the backend API endpoint.\n *\n * @param {string} endpoint The Firebase Auth backend endpoint.\n * @param {HttpMethod} httpMethod The http method for that endpoint.\n * @constructor\n */\nvar ApiSettings = /** @class */ (function () {\n    function ApiSettings(endpoint, httpMethod) {\n        if (httpMethod === void 0) { httpMethod = 'POST'; }\n        this.endpoint = endpoint;\n        this.httpMethod = httpMethod;\n        this.setRequestValidator(null)\n            .setResponseValidator(null);\n    }\n    /** @return {string} The backend API endpoint. */\n    ApiSettings.prototype.getEndpoint = function () {\n        return this.endpoint;\n    };\n    /** @return {HttpMethod} The request HTTP method. */\n    ApiSettings.prototype.getHttpMethod = function () {\n        return this.httpMethod;\n    };\n    /**\n     * @param {ApiCallbackFunction} requestValidator The request validator.\n     * @return {ApiSettings} The current API settings instance.\n     */\n    ApiSettings.prototype.setRequestValidator = function (requestValidator) {\n        var nullFunction = function () { return undefined; };\n        this.requestValidator = requestValidator || nullFunction;\n        return this;\n    };\n    /** @return {ApiCallbackFunction} The request validator. */\n    ApiSettings.prototype.getRequestValidator = function () {\n        return this.requestValidator;\n    };\n    /**\n     * @param {ApiCallbackFunction} responseValidator The response validator.\n     * @return {ApiSettings} The current API settings instance.\n     */\n    ApiSettings.prototype.setResponseValidator = function (responseValidator) {\n        var nullFunction = function () { return undefined; };\n        this.responseValidator = responseValidator || nullFunction;\n        return this;\n    };\n    /** @return {ApiCallbackFunction} The response validator. */\n    ApiSettings.prototype.getResponseValidator = function () {\n        return this.responseValidator;\n    };\n    return ApiSettings;\n}());\nexports.ApiSettings = ApiSettings;\n/**\n * Class used for polling an endpoint with exponential backoff.\n *\n * Example usage:\n * ```\n * const poller = new ExponentialBackoffPoller();\n * poller\n *     .poll(() => {\n *       return myRequestToPoll()\n *           .then((responseData: any) => {\n *             if (!isValid(responseData)) {\n *               // Continue polling.\n *               return null;\n *             }\n *\n *             // Polling complete. Resolve promise with final response data.\n *             return responseData;\n *           });\n *     })\n *     .then((responseData: any) => {\n *       console.log(`Final response: ${responseData}`);\n *     });\n * ```\n */\nvar ExponentialBackoffPoller = /** @class */ (function (_super) {\n    __extends(ExponentialBackoffPoller, _super);\n    function ExponentialBackoffPoller(initialPollingDelayMillis, maxPollingDelayMillis, masterTimeoutMillis) {\n        if (initialPollingDelayMillis === void 0) { initialPollingDelayMillis = 1000; }\n        if (maxPollingDelayMillis === void 0) { maxPollingDelayMillis = 10000; }\n        if (masterTimeoutMillis === void 0) { masterTimeoutMillis = 60000; }\n        var _this = _super.call(this) || this;\n        _this.initialPollingDelayMillis = initialPollingDelayMillis;\n        _this.maxPollingDelayMillis = maxPollingDelayMillis;\n        _this.masterTimeoutMillis = masterTimeoutMillis;\n        _this.numTries = 0;\n        _this.completed = false;\n        return _this;\n    }\n    /**\n     * Poll the provided callback with exponential backoff.\n     *\n     * @param {() => Promise<T>} callback The callback to be called for each poll. If the\n     *     callback resolves to a falsey value, polling will continue. Otherwise, the truthy\n     *     resolution will be used to resolve the promise returned by this method.\n     * @return {Promise<T>} A Promise which resolves to the truthy value returned by the provided\n     *     callback when polling is complete.\n     */\n    ExponentialBackoffPoller.prototype.poll = function (callback) {\n        var _this = this;\n        if (this.pollCallback) {\n            throw new Error('poll() can only be called once per instance of ExponentialBackoffPoller');\n        }\n        this.pollCallback = callback;\n        this.on('poll', this.repoll);\n        this.masterTimer = setTimeout(function () {\n            if (_this.completed) {\n                return;\n            }\n            _this.markCompleted();\n            _this.reject(new Error('ExponentialBackoffPoller deadline exceeded - Master timeout reached'));\n        }, this.masterTimeoutMillis);\n        return new Promise(function (resolve, reject) {\n            _this.resolve = resolve;\n            _this.reject = reject;\n            _this.repoll();\n        });\n    };\n    ExponentialBackoffPoller.prototype.repoll = function () {\n        var _this = this;\n        this.pollCallback()\n            .then(function (result) {\n            if (_this.completed) {\n                return;\n            }\n            if (!result) {\n                _this.repollTimer =\n                    setTimeout(function () { return _this.emit('poll'); }, _this.getPollingDelayMillis());\n                _this.numTries++;\n                return;\n            }\n            _this.markCompleted();\n            _this.resolve(result);\n        })\n            .catch(function (err) {\n            if (_this.completed) {\n                return;\n            }\n            _this.markCompleted();\n            _this.reject(err);\n        });\n    };\n    ExponentialBackoffPoller.prototype.getPollingDelayMillis = function () {\n        var increasedPollingDelay = Math.pow(2, this.numTries) * this.initialPollingDelayMillis;\n        return Math.min(increasedPollingDelay, this.maxPollingDelayMillis);\n    };\n    ExponentialBackoffPoller.prototype.markCompleted = function () {\n        this.completed = true;\n        if (this.masterTimer) {\n            clearTimeout(this.masterTimer);\n        }\n        if (this.repollTimer) {\n            clearTimeout(this.repollTimer);\n        }\n    };\n    return ExponentialBackoffPoller;\n}(events_1.EventEmitter));\nexports.ExponentialBackoffPoller = ExponentialBackoffPoller;\n"]},"metadata":{},"sourceType":"script"}