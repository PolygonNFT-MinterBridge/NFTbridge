{"ast":null,"code":"\"use strict\";\n/*\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *       http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst reference_1 = require(\"./reference\");\n\nconst path_1 = require(\"./path\");\n\nconst serializer_1 = require(\"./serializer\");\n/**\n * A split point that can be used in a query as a starting and/or end point for\n * the query results. The cursors returned by {@link #startAt} and {@link\n * #endBefore} can only be used in a query that matches the constraint of query\n * that produced this partition.\n *\n * @class QueryPartition\n */\n\n\nclass QueryPartition {\n  /** @hideconstructor */\n  constructor(_firestore, _collectionId, _converter, _startAt, _endBefore) {\n    this._firestore = _firestore;\n    this._collectionId = _collectionId;\n    this._converter = _converter;\n    this._startAt = _startAt;\n    this._endBefore = _endBefore;\n    this._serializer = new serializer_1.Serializer(_firestore);\n  }\n  /**\n   * The cursor that defines the first result for this partition or `undefined`\n   * if this is the first partition. The cursor value must be\n   * destructured when passed to `startAt()` (for example with\n   * `query.startAt(...queryPartition.startAt)`).\n   *\n   * @example\n   * const query = firestore.collectionGroup('collectionId');\n   * for await (const partition of query.getPartitions(42)) {\n   *   let partitionedQuery = query.orderBy(FieldPath.documentId());\n   *   if (partition.startAt) {\n   *     partitionedQuery = partitionedQuery.startAt(...partition.startAt);\n   *   }\n   *   if (partition.endBefore) {\n   *     partitionedQuery = partitionedQuery.endBefore(...partition.endBefore);\n   *   }\n   *   const querySnapshot = await partitionedQuery.get();\n   *   console.log(`Partition contained ${querySnapshot.length} documents`);\n   * }\n   *\n   * @type {Array<*>}\n   * @return {Array<*>} A cursor value that can be used with {@link\n   * Query#startAt} or `undefined` if this is the first partition.\n   */\n\n\n  get startAt() {\n    if (this._startAt && !this._memoizedStartAt) {\n      this._memoizedStartAt = this._startAt.map(v => this._serializer.decodeValue(v));\n    }\n\n    return this._memoizedStartAt;\n  }\n  /**\n   * The cursor that defines the first result after this partition or\n   * `undefined` if this is the last partition.  The cursor value must be\n   * destructured when passed to `endBefore()` (for example with\n   * `query.endBefore(...queryPartition.endBefore)`).\n   *\n   * @example\n   * const query = firestore.collectionGroup('collectionId');\n   * for await (const partition of query.getPartitions(42)) {\n   *   let partitionedQuery = query.orderBy(FieldPath.documentId());\n   *   if (partition.startAt) {\n   *     partitionedQuery = partitionedQuery.startAt(...partition.startAt);\n   *   }\n   *   if (partition.endBefore) {\n   *     partitionedQuery = partitionedQuery.endBefore(...partition.endBefore);\n   *   }\n   *   const querySnapshot = await partitionedQuery.get();\n   *   console.log(`Partition contained ${querySnapshot.length} documents`);\n   * }\n   *\n   * @type {Array<*>}\n   * @return {Array<*>} A cursor value that can be used with {@link\n   * Query#endBefore} or `undefined` if this is the last partition.\n   */\n\n\n  get endBefore() {\n    if (this._endBefore && !this._memoizedEndBefore) {\n      this._memoizedEndBefore = this._endBefore.map(v => this._serializer.decodeValue(v));\n    }\n\n    return this._memoizedEndBefore;\n  }\n  /**\n   * Returns a query that only encapsulates the documents for this partition.\n   *\n   * @example\n   * const query = firestore.collectionGroup('collectionId');\n   * for await (const partition of query.getPartitions(42)) {\n   *   const partitionedQuery = partition.toQuery();\n   *   const querySnapshot = await partitionedQuery.get();\n   *   console.log(`Partition contained ${querySnapshot.length} documents`);\n   * }\n   *\n   * @return {Query<T>} A query partitioned by a {@link Query#startAt} and\n   * {@link Query#endBefore} cursor.\n   */\n\n\n  toQuery() {\n    // Since the api.Value to JavaScript type conversion can be lossy (unless\n    // `useBigInt` is used), we pass the original protobuf representation to the\n    // created query.\n    let queryOptions = reference_1.QueryOptions.forCollectionGroupQuery(this._collectionId, this._converter);\n    queryOptions = queryOptions.with({\n      fieldOrders: [new reference_1.FieldOrder(path_1.FieldPath.documentId())]\n    });\n\n    if (this._startAt !== undefined) {\n      queryOptions = queryOptions.with({\n        startAt: {\n          before: true,\n          values: this._startAt\n        }\n      });\n    }\n\n    if (this._endBefore !== undefined) {\n      queryOptions = queryOptions.with({\n        endAt: {\n          before: true,\n          values: this._endBefore\n        }\n      });\n    }\n\n    return new reference_1.Query(this._firestore, queryOptions);\n  }\n\n}\n\nexports.QueryPartition = QueryPartition;","map":{"version":3,"sources":["/Users/piyushmaheshwari/Downloads/github/Bridgeorg/node_modules/@google-cloud/firestore/build/src/query-partition.js"],"names":["Object","defineProperty","exports","value","reference_1","require","path_1","serializer_1","QueryPartition","constructor","_firestore","_collectionId","_converter","_startAt","_endBefore","_serializer","Serializer","startAt","_memoizedStartAt","map","v","decodeValue","endBefore","_memoizedEndBefore","toQuery","queryOptions","QueryOptions","forCollectionGroupQuery","with","fieldOrders","FieldOrder","FieldPath","documentId","undefined","before","values","endAt","Query"],"mappings":"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","sourcesContent":["\"use strict\";\n/*\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *       http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst reference_1 = require(\"./reference\");\nconst path_1 = require(\"./path\");\nconst serializer_1 = require(\"./serializer\");\n/**\n * A split point that can be used in a query as a starting and/or end point for\n * the query results. The cursors returned by {@link #startAt} and {@link\n * #endBefore} can only be used in a query that matches the constraint of query\n * that produced this partition.\n *\n * @class QueryPartition\n */\nclass QueryPartition {\n    /** @hideconstructor */\n    constructor(_firestore, _collectionId, _converter, _startAt, _endBefore) {\n        this._firestore = _firestore;\n        this._collectionId = _collectionId;\n        this._converter = _converter;\n        this._startAt = _startAt;\n        this._endBefore = _endBefore;\n        this._serializer = new serializer_1.Serializer(_firestore);\n    }\n    /**\n     * The cursor that defines the first result for this partition or `undefined`\n     * if this is the first partition. The cursor value must be\n     * destructured when passed to `startAt()` (for example with\n     * `query.startAt(...queryPartition.startAt)`).\n     *\n     * @example\n     * const query = firestore.collectionGroup('collectionId');\n     * for await (const partition of query.getPartitions(42)) {\n     *   let partitionedQuery = query.orderBy(FieldPath.documentId());\n     *   if (partition.startAt) {\n     *     partitionedQuery = partitionedQuery.startAt(...partition.startAt);\n     *   }\n     *   if (partition.endBefore) {\n     *     partitionedQuery = partitionedQuery.endBefore(...partition.endBefore);\n     *   }\n     *   const querySnapshot = await partitionedQuery.get();\n     *   console.log(`Partition contained ${querySnapshot.length} documents`);\n     * }\n     *\n     * @type {Array<*>}\n     * @return {Array<*>} A cursor value that can be used with {@link\n     * Query#startAt} or `undefined` if this is the first partition.\n     */\n    get startAt() {\n        if (this._startAt && !this._memoizedStartAt) {\n            this._memoizedStartAt = this._startAt.map(v => this._serializer.decodeValue(v));\n        }\n        return this._memoizedStartAt;\n    }\n    /**\n     * The cursor that defines the first result after this partition or\n     * `undefined` if this is the last partition.  The cursor value must be\n     * destructured when passed to `endBefore()` (for example with\n     * `query.endBefore(...queryPartition.endBefore)`).\n     *\n     * @example\n     * const query = firestore.collectionGroup('collectionId');\n     * for await (const partition of query.getPartitions(42)) {\n     *   let partitionedQuery = query.orderBy(FieldPath.documentId());\n     *   if (partition.startAt) {\n     *     partitionedQuery = partitionedQuery.startAt(...partition.startAt);\n     *   }\n     *   if (partition.endBefore) {\n     *     partitionedQuery = partitionedQuery.endBefore(...partition.endBefore);\n     *   }\n     *   const querySnapshot = await partitionedQuery.get();\n     *   console.log(`Partition contained ${querySnapshot.length} documents`);\n     * }\n     *\n     * @type {Array<*>}\n     * @return {Array<*>} A cursor value that can be used with {@link\n     * Query#endBefore} or `undefined` if this is the last partition.\n     */\n    get endBefore() {\n        if (this._endBefore && !this._memoizedEndBefore) {\n            this._memoizedEndBefore = this._endBefore.map(v => this._serializer.decodeValue(v));\n        }\n        return this._memoizedEndBefore;\n    }\n    /**\n     * Returns a query that only encapsulates the documents for this partition.\n     *\n     * @example\n     * const query = firestore.collectionGroup('collectionId');\n     * for await (const partition of query.getPartitions(42)) {\n     *   const partitionedQuery = partition.toQuery();\n     *   const querySnapshot = await partitionedQuery.get();\n     *   console.log(`Partition contained ${querySnapshot.length} documents`);\n     * }\n     *\n     * @return {Query<T>} A query partitioned by a {@link Query#startAt} and\n     * {@link Query#endBefore} cursor.\n     */\n    toQuery() {\n        // Since the api.Value to JavaScript type conversion can be lossy (unless\n        // `useBigInt` is used), we pass the original protobuf representation to the\n        // created query.\n        let queryOptions = reference_1.QueryOptions.forCollectionGroupQuery(this._collectionId, this._converter);\n        queryOptions = queryOptions.with({\n            fieldOrders: [new reference_1.FieldOrder(path_1.FieldPath.documentId())],\n        });\n        if (this._startAt !== undefined) {\n            queryOptions = queryOptions.with({\n                startAt: { before: true, values: this._startAt },\n            });\n        }\n        if (this._endBefore !== undefined) {\n            queryOptions = queryOptions.with({\n                endAt: { before: true, values: this._endBefore },\n            });\n        }\n        return new reference_1.Query(this._firestore, queryOptions);\n    }\n}\nexports.QueryPartition = QueryPartition;\n//# sourceMappingURL=query-partition.js.map"]},"metadata":{},"sourceType":"script"}