{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __values = this && this.__values || function (o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n      m = s && o[s],\n      i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BaseTransaction = void 0;\n\nvar common_1 = __importStar(require(\"@ethereumjs/common\"));\n\nvar ethereumjs_util_1 = require(\"ethereumjs-util\");\n\nvar types_1 = require(\"./types\");\n/**\n * This base class will likely be subject to further\n * refactoring along the introduction of additional tx types\n * on the Ethereum network.\n *\n * It is therefore not recommended to use directly.\n */\n\n\nvar BaseTransaction =\n/** @class */\nfunction () {\n  function BaseTransaction(txData) {\n    this.cache = {\n      hash: undefined,\n      dataFee: undefined\n    };\n    /**\n     * List of tx type defining EIPs,\n     * e.g. 1559 (fee market) and 2930 (access lists)\n     * for FeeMarketEIP1559Transaction objects\n     */\n\n    this.activeCapabilities = [];\n    /**\n     * The default chain the tx falls back to if no Common\n     * is provided and if the chain can't be derived from\n     * a passed in chainId (only EIP-2718 typed txs) or\n     * EIP-155 signature (legacy txs).\n     *\n     * @hidden\n     */\n\n    this.DEFAULT_CHAIN = common_1.Chain.Mainnet;\n    /**\n     * The default HF if the tx type is active on that HF\n     * or the first greater HF where the tx is active.\n     *\n     * @hidden\n     */\n\n    this.DEFAULT_HARDFORK = common_1.Hardfork.Istanbul;\n    var nonce = txData.nonce,\n        gasLimit = txData.gasLimit,\n        to = txData.to,\n        value = txData.value,\n        data = txData.data,\n        v = txData.v,\n        r = txData.r,\n        s = txData.s,\n        type = txData.type;\n    this._type = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(type)).toNumber();\n    var toB = (0, ethereumjs_util_1.toBuffer)(to === '' ? '0x' : to);\n    var vB = (0, ethereumjs_util_1.toBuffer)(v === '' ? '0x' : v);\n    var rB = (0, ethereumjs_util_1.toBuffer)(r === '' ? '0x' : r);\n    var sB = (0, ethereumjs_util_1.toBuffer)(s === '' ? '0x' : s);\n    this.nonce = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(nonce === '' ? '0x' : nonce));\n    this.gasLimit = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(gasLimit === '' ? '0x' : gasLimit));\n    this.to = toB.length > 0 ? new ethereumjs_util_1.Address(toB) : undefined;\n    this.value = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(value === '' ? '0x' : value));\n    this.data = (0, ethereumjs_util_1.toBuffer)(data === '' ? '0x' : data);\n    this.v = vB.length > 0 ? new ethereumjs_util_1.BN(vB) : undefined;\n    this.r = rB.length > 0 ? new ethereumjs_util_1.BN(rB) : undefined;\n    this.s = sB.length > 0 ? new ethereumjs_util_1.BN(sB) : undefined;\n\n    this._validateCannotExceedMaxInteger({\n      value: this.value,\n      r: this.r,\n      s: this.s\n    }); // geth limits gasLimit to 2^64-1\n\n\n    this._validateCannotExceedMaxInteger({\n      gasLimit: this.gasLimit\n    }, 64); // EIP-2681 limits nonce to 2^64-1 (cannot equal 2^64-1)\n\n\n    this._validateCannotExceedMaxInteger({\n      nonce: this.nonce\n    }, 64, true);\n  }\n\n  Object.defineProperty(BaseTransaction.prototype, \"transactionType\", {\n    /**\n     * Alias for {@link BaseTransaction.type}\n     *\n     * @deprecated Use `type` instead\n     */\n    get: function () {\n      return this.type;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BaseTransaction.prototype, \"type\", {\n    /**\n     * Returns the transaction type.\n     *\n     * Note: legacy txs will return tx type `0`.\n     */\n    get: function () {\n      return this._type;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Checks if a tx type defining capability is active\n   * on a tx, for example the EIP-1559 fee market mechanism\n   * or the EIP-2930 access list feature.\n   *\n   * Note that this is different from the tx type itself,\n   * so EIP-2930 access lists can very well be active\n   * on an EIP-1559 tx for example.\n   *\n   * This method can be useful for feature checks if the\n   * tx type is unknown (e.g. when instantiated with\n   * the tx factory).\n   *\n   * See `Capabilites` in the `types` module for a reference\n   * on all supported capabilities.\n   */\n\n  BaseTransaction.prototype.supports = function (capability) {\n    return this.activeCapabilities.includes(capability);\n  };\n\n  BaseTransaction.prototype.validate = function (stringError) {\n    if (stringError === void 0) {\n      stringError = false;\n    }\n\n    var errors = [];\n\n    if (this.getBaseFee().gt(this.gasLimit)) {\n      errors.push(\"gasLimit is too low. given \".concat(this.gasLimit, \", need at least \").concat(this.getBaseFee()));\n    }\n\n    if (this.isSigned() && !this.verifySignature()) {\n      errors.push('Invalid Signature');\n    }\n\n    return stringError ? errors : errors.length === 0;\n  };\n  /**\n   * The minimum amount of gas the tx must have (DataFee + TxFee + Creation Fee)\n   */\n\n\n  BaseTransaction.prototype.getBaseFee = function () {\n    var fee = this.getDataFee().addn(this.common.param('gasPrices', 'tx'));\n\n    if (this.common.gteHardfork('homestead') && this.toCreationAddress()) {\n      fee.iaddn(this.common.param('gasPrices', 'txCreation'));\n    }\n\n    return fee;\n  };\n  /**\n   * The amount of gas paid for the data in this tx\n   */\n\n\n  BaseTransaction.prototype.getDataFee = function () {\n    var txDataZero = this.common.param('gasPrices', 'txDataZero');\n    var txDataNonZero = this.common.param('gasPrices', 'txDataNonZero');\n    var cost = 0;\n\n    for (var i = 0; i < this.data.length; i++) {\n      this.data[i] === 0 ? cost += txDataZero : cost += txDataNonZero;\n    }\n\n    return new ethereumjs_util_1.BN(cost);\n  };\n  /**\n   * If the tx's `to` is to the creation address\n   */\n\n\n  BaseTransaction.prototype.toCreationAddress = function () {\n    return this.to === undefined || this.to.buf.length === 0;\n  };\n\n  BaseTransaction.prototype.isSigned = function () {\n    var _a = this,\n        v = _a.v,\n        r = _a.r,\n        s = _a.s;\n\n    if (this.type === 0) {\n      if (!v || !r || !s) {\n        return false;\n      } else {\n        return true;\n      }\n    } else {\n      if (v === undefined || !r || !s) {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  };\n  /**\n   * Determines if the signature is valid\n   */\n\n\n  BaseTransaction.prototype.verifySignature = function () {\n    try {\n      // Main signature verification is done in `getSenderPublicKey()`\n      var publicKey = this.getSenderPublicKey();\n      return (0, ethereumjs_util_1.unpadBuffer)(publicKey).length !== 0;\n    } catch (e) {\n      return false;\n    }\n  };\n  /**\n   * Returns the sender's address\n   */\n\n\n  BaseTransaction.prototype.getSenderAddress = function () {\n    return new ethereumjs_util_1.Address((0, ethereumjs_util_1.publicToAddress)(this.getSenderPublicKey()));\n  };\n  /**\n   * Signs a transaction.\n   *\n   * Note that the signed tx is returned as a new object,\n   * use as follows:\n   * ```javascript\n   * const signedTx = tx.sign(privateKey)\n   * ```\n   */\n\n\n  BaseTransaction.prototype.sign = function (privateKey) {\n    if (privateKey.length !== 32) {\n      var msg = this._errorMsg('Private key must be 32 bytes in length.');\n\n      throw new Error(msg);\n    } // Hack for the constellation that we have got a legacy tx after spuriousDragon with a non-EIP155 conforming signature\n    // and want to recreate a signature (where EIP155 should be applied)\n    // Leaving this hack lets the legacy.spec.ts -> sign(), verifySignature() test fail\n    // 2021-06-23\n\n\n    var hackApplied = false;\n\n    if (this.type === 0 && this.common.gteHardfork('spuriousDragon') && !this.supports(types_1.Capability.EIP155ReplayProtection)) {\n      this.activeCapabilities.push(types_1.Capability.EIP155ReplayProtection);\n      hackApplied = true;\n    }\n\n    var msgHash = this.getMessageToSign(true);\n\n    var _a = (0, ethereumjs_util_1.ecsign)(msgHash, privateKey),\n        v = _a.v,\n        r = _a.r,\n        s = _a.s;\n\n    var tx = this._processSignature(v, r, s); // Hack part 2\n\n\n    if (hackApplied) {\n      var index = this.activeCapabilities.indexOf(types_1.Capability.EIP155ReplayProtection);\n\n      if (index > -1) {\n        this.activeCapabilities.splice(index, 1);\n      }\n    }\n\n    return tx;\n  };\n  /**\n   * Does chain ID checks on common and returns a common\n   * to be used on instantiation\n   * @hidden\n   *\n   * @param common - {@link Common} instance from tx options\n   * @param chainId - Chain ID from tx options (typed txs) or signature (legacy tx)\n   */\n\n\n  BaseTransaction.prototype._getCommon = function (common, chainId) {\n    var _a; // Chain ID provided\n\n\n    if (chainId) {\n      var chainIdBN = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(chainId));\n\n      if (common) {\n        if (!common.chainIdBN().eq(chainIdBN)) {\n          var msg = this._errorMsg('The chain ID does not match the chain ID of Common');\n\n          throw new Error(msg);\n        } // Common provided, chain ID does match\n        // -> Return provided Common\n\n\n        return common.copy();\n      } else {\n        if (common_1.default.isSupportedChainId(chainIdBN)) {\n          // No Common, chain ID supported by Common\n          // -> Instantiate Common with chain ID\n          return new common_1.default({\n            chain: chainIdBN,\n            hardfork: this.DEFAULT_HARDFORK\n          });\n        } else {\n          // No Common, chain ID not supported by Common\n          // -> Instantiate custom Common derived from DEFAULT_CHAIN\n          return common_1.default.forCustomChain(this.DEFAULT_CHAIN, {\n            name: 'custom-chain',\n            networkId: chainIdBN,\n            chainId: chainIdBN\n          }, this.DEFAULT_HARDFORK);\n        }\n      }\n    } else {\n      // No chain ID provided\n      // -> return Common provided or create new default Common\n      return (_a = common === null || common === void 0 ? void 0 : common.copy()) !== null && _a !== void 0 ? _a : new common_1.default({\n        chain: this.DEFAULT_CHAIN,\n        hardfork: this.DEFAULT_HARDFORK\n      });\n    }\n  };\n  /**\n   * Validates that an object with BN values cannot exceed the specified bit limit.\n   * @param values Object containing string keys and BN values\n   * @param bits Number of bits to check (64 or 256)\n   * @param cannotEqual Pass true if the number also cannot equal one less the maximum value\n   */\n\n\n  BaseTransaction.prototype._validateCannotExceedMaxInteger = function (values, bits, cannotEqual) {\n    var e_1, _a;\n\n    if (bits === void 0) {\n      bits = 256;\n    }\n\n    if (cannotEqual === void 0) {\n      cannotEqual = false;\n    }\n\n    try {\n      for (var _b = __values(Object.entries(values)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var _d = __read(_c.value, 2),\n            key = _d[0],\n            value = _d[1];\n\n        switch (bits) {\n          case 64:\n            if (cannotEqual) {\n              if (value === null || value === void 0 ? void 0 : value.gte(ethereumjs_util_1.MAX_UINT64)) {\n                var msg = this._errorMsg(\"\".concat(key, \" cannot equal or exceed MAX_UINT64 (2^64-1), given \").concat(value));\n\n                throw new Error(msg);\n              }\n            } else {\n              if (value === null || value === void 0 ? void 0 : value.gt(ethereumjs_util_1.MAX_UINT64)) {\n                var msg = this._errorMsg(\"\".concat(key, \" cannot exceed MAX_UINT64 (2^64-1), given \").concat(value));\n\n                throw new Error(msg);\n              }\n            }\n\n            break;\n\n          case 256:\n            if (cannotEqual) {\n              if (value === null || value === void 0 ? void 0 : value.gte(ethereumjs_util_1.MAX_INTEGER)) {\n                var msg = this._errorMsg(\"\".concat(key, \" cannot equal or exceed MAX_INTEGER (2^256-1), given \").concat(value));\n\n                throw new Error(msg);\n              }\n            } else {\n              if (value === null || value === void 0 ? void 0 : value.gt(ethereumjs_util_1.MAX_INTEGER)) {\n                var msg = this._errorMsg(\"\".concat(key, \" cannot exceed MAX_INTEGER (2^256-1), given \").concat(value));\n\n                throw new Error(msg);\n              }\n            }\n\n            break;\n\n          default:\n            {\n              var msg = this._errorMsg('unimplemented bits value');\n\n              throw new Error(msg);\n            }\n        }\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n  /**\n   * Returns the shared error postfix part for _error() method\n   * tx type implementations.\n   */\n\n\n  BaseTransaction.prototype._getSharedErrorPostfix = function () {\n    var hash = '';\n\n    try {\n      hash = this.isSigned() ? (0, ethereumjs_util_1.bufferToHex)(this.hash()) : 'not available (unsigned)';\n    } catch (e) {\n      hash = 'error';\n    }\n\n    var isSigned = '';\n\n    try {\n      isSigned = this.isSigned().toString();\n    } catch (e) {\n      hash = 'error';\n    }\n\n    var hf = '';\n\n    try {\n      hf = this.common.hardfork();\n    } catch (e) {\n      hf = 'error';\n    }\n\n    var postfix = \"tx type=\".concat(this.type, \" hash=\").concat(hash, \" nonce=\").concat(this.nonce, \" value=\").concat(this.value, \" \");\n    postfix += \"signed=\".concat(isSigned, \" hf=\").concat(hf);\n    return postfix;\n  };\n\n  return BaseTransaction;\n}();\n\nexports.BaseTransaction = BaseTransaction;","map":{"version":3,"sources":["../src/baseTransaction.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BaseTransaction = void 0;\nvar common_1 = __importStar(require(\"@ethereumjs/common\"));\nvar ethereumjs_util_1 = require(\"ethereumjs-util\");\nvar types_1 = require(\"./types\");\n/**\n * This base class will likely be subject to further\n * refactoring along the introduction of additional tx types\n * on the Ethereum network.\n *\n * It is therefore not recommended to use directly.\n */\nvar BaseTransaction = /** @class */ (function () {\n    function BaseTransaction(txData) {\n        this.cache = {\n            hash: undefined,\n            dataFee: undefined,\n        };\n        /**\n         * List of tx type defining EIPs,\n         * e.g. 1559 (fee market) and 2930 (access lists)\n         * for FeeMarketEIP1559Transaction objects\n         */\n        this.activeCapabilities = [];\n        /**\n         * The default chain the tx falls back to if no Common\n         * is provided and if the chain can't be derived from\n         * a passed in chainId (only EIP-2718 typed txs) or\n         * EIP-155 signature (legacy txs).\n         *\n         * @hidden\n         */\n        this.DEFAULT_CHAIN = common_1.Chain.Mainnet;\n        /**\n         * The default HF if the tx type is active on that HF\n         * or the first greater HF where the tx is active.\n         *\n         * @hidden\n         */\n        this.DEFAULT_HARDFORK = common_1.Hardfork.Istanbul;\n        var nonce = txData.nonce, gasLimit = txData.gasLimit, to = txData.to, value = txData.value, data = txData.data, v = txData.v, r = txData.r, s = txData.s, type = txData.type;\n        this._type = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(type)).toNumber();\n        var toB = (0, ethereumjs_util_1.toBuffer)(to === '' ? '0x' : to);\n        var vB = (0, ethereumjs_util_1.toBuffer)(v === '' ? '0x' : v);\n        var rB = (0, ethereumjs_util_1.toBuffer)(r === '' ? '0x' : r);\n        var sB = (0, ethereumjs_util_1.toBuffer)(s === '' ? '0x' : s);\n        this.nonce = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(nonce === '' ? '0x' : nonce));\n        this.gasLimit = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(gasLimit === '' ? '0x' : gasLimit));\n        this.to = toB.length > 0 ? new ethereumjs_util_1.Address(toB) : undefined;\n        this.value = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(value === '' ? '0x' : value));\n        this.data = (0, ethereumjs_util_1.toBuffer)(data === '' ? '0x' : data);\n        this.v = vB.length > 0 ? new ethereumjs_util_1.BN(vB) : undefined;\n        this.r = rB.length > 0 ? new ethereumjs_util_1.BN(rB) : undefined;\n        this.s = sB.length > 0 ? new ethereumjs_util_1.BN(sB) : undefined;\n        this._validateCannotExceedMaxInteger({ value: this.value, r: this.r, s: this.s });\n        // geth limits gasLimit to 2^64-1\n        this._validateCannotExceedMaxInteger({ gasLimit: this.gasLimit }, 64);\n        // EIP-2681 limits nonce to 2^64-1 (cannot equal 2^64-1)\n        this._validateCannotExceedMaxInteger({ nonce: this.nonce }, 64, true);\n    }\n    Object.defineProperty(BaseTransaction.prototype, \"transactionType\", {\n        /**\n         * Alias for {@link BaseTransaction.type}\n         *\n         * @deprecated Use `type` instead\n         */\n        get: function () {\n            return this.type;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(BaseTransaction.prototype, \"type\", {\n        /**\n         * Returns the transaction type.\n         *\n         * Note: legacy txs will return tx type `0`.\n         */\n        get: function () {\n            return this._type;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Checks if a tx type defining capability is active\n     * on a tx, for example the EIP-1559 fee market mechanism\n     * or the EIP-2930 access list feature.\n     *\n     * Note that this is different from the tx type itself,\n     * so EIP-2930 access lists can very well be active\n     * on an EIP-1559 tx for example.\n     *\n     * This method can be useful for feature checks if the\n     * tx type is unknown (e.g. when instantiated with\n     * the tx factory).\n     *\n     * See `Capabilites` in the `types` module for a reference\n     * on all supported capabilities.\n     */\n    BaseTransaction.prototype.supports = function (capability) {\n        return this.activeCapabilities.includes(capability);\n    };\n    BaseTransaction.prototype.validate = function (stringError) {\n        if (stringError === void 0) { stringError = false; }\n        var errors = [];\n        if (this.getBaseFee().gt(this.gasLimit)) {\n            errors.push(\"gasLimit is too low. given \".concat(this.gasLimit, \", need at least \").concat(this.getBaseFee()));\n        }\n        if (this.isSigned() && !this.verifySignature()) {\n            errors.push('Invalid Signature');\n        }\n        return stringError ? errors : errors.length === 0;\n    };\n    /**\n     * The minimum amount of gas the tx must have (DataFee + TxFee + Creation Fee)\n     */\n    BaseTransaction.prototype.getBaseFee = function () {\n        var fee = this.getDataFee().addn(this.common.param('gasPrices', 'tx'));\n        if (this.common.gteHardfork('homestead') && this.toCreationAddress()) {\n            fee.iaddn(this.common.param('gasPrices', 'txCreation'));\n        }\n        return fee;\n    };\n    /**\n     * The amount of gas paid for the data in this tx\n     */\n    BaseTransaction.prototype.getDataFee = function () {\n        var txDataZero = this.common.param('gasPrices', 'txDataZero');\n        var txDataNonZero = this.common.param('gasPrices', 'txDataNonZero');\n        var cost = 0;\n        for (var i = 0; i < this.data.length; i++) {\n            this.data[i] === 0 ? (cost += txDataZero) : (cost += txDataNonZero);\n        }\n        return new ethereumjs_util_1.BN(cost);\n    };\n    /**\n     * If the tx's `to` is to the creation address\n     */\n    BaseTransaction.prototype.toCreationAddress = function () {\n        return this.to === undefined || this.to.buf.length === 0;\n    };\n    BaseTransaction.prototype.isSigned = function () {\n        var _a = this, v = _a.v, r = _a.r, s = _a.s;\n        if (this.type === 0) {\n            if (!v || !r || !s) {\n                return false;\n            }\n            else {\n                return true;\n            }\n        }\n        else {\n            if (v === undefined || !r || !s) {\n                return false;\n            }\n            else {\n                return true;\n            }\n        }\n    };\n    /**\n     * Determines if the signature is valid\n     */\n    BaseTransaction.prototype.verifySignature = function () {\n        try {\n            // Main signature verification is done in `getSenderPublicKey()`\n            var publicKey = this.getSenderPublicKey();\n            return (0, ethereumjs_util_1.unpadBuffer)(publicKey).length !== 0;\n        }\n        catch (e) {\n            return false;\n        }\n    };\n    /**\n     * Returns the sender's address\n     */\n    BaseTransaction.prototype.getSenderAddress = function () {\n        return new ethereumjs_util_1.Address((0, ethereumjs_util_1.publicToAddress)(this.getSenderPublicKey()));\n    };\n    /**\n     * Signs a transaction.\n     *\n     * Note that the signed tx is returned as a new object,\n     * use as follows:\n     * ```javascript\n     * const signedTx = tx.sign(privateKey)\n     * ```\n     */\n    BaseTransaction.prototype.sign = function (privateKey) {\n        if (privateKey.length !== 32) {\n            var msg = this._errorMsg('Private key must be 32 bytes in length.');\n            throw new Error(msg);\n        }\n        // Hack for the constellation that we have got a legacy tx after spuriousDragon with a non-EIP155 conforming signature\n        // and want to recreate a signature (where EIP155 should be applied)\n        // Leaving this hack lets the legacy.spec.ts -> sign(), verifySignature() test fail\n        // 2021-06-23\n        var hackApplied = false;\n        if (this.type === 0 &&\n            this.common.gteHardfork('spuriousDragon') &&\n            !this.supports(types_1.Capability.EIP155ReplayProtection)) {\n            this.activeCapabilities.push(types_1.Capability.EIP155ReplayProtection);\n            hackApplied = true;\n        }\n        var msgHash = this.getMessageToSign(true);\n        var _a = (0, ethereumjs_util_1.ecsign)(msgHash, privateKey), v = _a.v, r = _a.r, s = _a.s;\n        var tx = this._processSignature(v, r, s);\n        // Hack part 2\n        if (hackApplied) {\n            var index = this.activeCapabilities.indexOf(types_1.Capability.EIP155ReplayProtection);\n            if (index > -1) {\n                this.activeCapabilities.splice(index, 1);\n            }\n        }\n        return tx;\n    };\n    /**\n     * Does chain ID checks on common and returns a common\n     * to be used on instantiation\n     * @hidden\n     *\n     * @param common - {@link Common} instance from tx options\n     * @param chainId - Chain ID from tx options (typed txs) or signature (legacy tx)\n     */\n    BaseTransaction.prototype._getCommon = function (common, chainId) {\n        var _a;\n        // Chain ID provided\n        if (chainId) {\n            var chainIdBN = new ethereumjs_util_1.BN((0, ethereumjs_util_1.toBuffer)(chainId));\n            if (common) {\n                if (!common.chainIdBN().eq(chainIdBN)) {\n                    var msg = this._errorMsg('The chain ID does not match the chain ID of Common');\n                    throw new Error(msg);\n                }\n                // Common provided, chain ID does match\n                // -> Return provided Common\n                return common.copy();\n            }\n            else {\n                if (common_1.default.isSupportedChainId(chainIdBN)) {\n                    // No Common, chain ID supported by Common\n                    // -> Instantiate Common with chain ID\n                    return new common_1.default({ chain: chainIdBN, hardfork: this.DEFAULT_HARDFORK });\n                }\n                else {\n                    // No Common, chain ID not supported by Common\n                    // -> Instantiate custom Common derived from DEFAULT_CHAIN\n                    return common_1.default.forCustomChain(this.DEFAULT_CHAIN, {\n                        name: 'custom-chain',\n                        networkId: chainIdBN,\n                        chainId: chainIdBN,\n                    }, this.DEFAULT_HARDFORK);\n                }\n            }\n        }\n        else {\n            // No chain ID provided\n            // -> return Common provided or create new default Common\n            return ((_a = common === null || common === void 0 ? void 0 : common.copy()) !== null && _a !== void 0 ? _a : new common_1.default({ chain: this.DEFAULT_CHAIN, hardfork: this.DEFAULT_HARDFORK }));\n        }\n    };\n    /**\n     * Validates that an object with BN values cannot exceed the specified bit limit.\n     * @param values Object containing string keys and BN values\n     * @param bits Number of bits to check (64 or 256)\n     * @param cannotEqual Pass true if the number also cannot equal one less the maximum value\n     */\n    BaseTransaction.prototype._validateCannotExceedMaxInteger = function (values, bits, cannotEqual) {\n        var e_1, _a;\n        if (bits === void 0) { bits = 256; }\n        if (cannotEqual === void 0) { cannotEqual = false; }\n        try {\n            for (var _b = __values(Object.entries(values)), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var _d = __read(_c.value, 2), key = _d[0], value = _d[1];\n                switch (bits) {\n                    case 64:\n                        if (cannotEqual) {\n                            if (value === null || value === void 0 ? void 0 : value.gte(ethereumjs_util_1.MAX_UINT64)) {\n                                var msg = this._errorMsg(\"\".concat(key, \" cannot equal or exceed MAX_UINT64 (2^64-1), given \").concat(value));\n                                throw new Error(msg);\n                            }\n                        }\n                        else {\n                            if (value === null || value === void 0 ? void 0 : value.gt(ethereumjs_util_1.MAX_UINT64)) {\n                                var msg = this._errorMsg(\"\".concat(key, \" cannot exceed MAX_UINT64 (2^64-1), given \").concat(value));\n                                throw new Error(msg);\n                            }\n                        }\n                        break;\n                    case 256:\n                        if (cannotEqual) {\n                            if (value === null || value === void 0 ? void 0 : value.gte(ethereumjs_util_1.MAX_INTEGER)) {\n                                var msg = this._errorMsg(\"\".concat(key, \" cannot equal or exceed MAX_INTEGER (2^256-1), given \").concat(value));\n                                throw new Error(msg);\n                            }\n                        }\n                        else {\n                            if (value === null || value === void 0 ? void 0 : value.gt(ethereumjs_util_1.MAX_INTEGER)) {\n                                var msg = this._errorMsg(\"\".concat(key, \" cannot exceed MAX_INTEGER (2^256-1), given \").concat(value));\n                                throw new Error(msg);\n                            }\n                        }\n                        break;\n                    default: {\n                        var msg = this._errorMsg('unimplemented bits value');\n                        throw new Error(msg);\n                    }\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    };\n    /**\n     * Returns the shared error postfix part for _error() method\n     * tx type implementations.\n     */\n    BaseTransaction.prototype._getSharedErrorPostfix = function () {\n        var hash = '';\n        try {\n            hash = this.isSigned() ? (0, ethereumjs_util_1.bufferToHex)(this.hash()) : 'not available (unsigned)';\n        }\n        catch (e) {\n            hash = 'error';\n        }\n        var isSigned = '';\n        try {\n            isSigned = this.isSigned().toString();\n        }\n        catch (e) {\n            hash = 'error';\n        }\n        var hf = '';\n        try {\n            hf = this.common.hardfork();\n        }\n        catch (e) {\n            hf = 'error';\n        }\n        var postfix = \"tx type=\".concat(this.type, \" hash=\").concat(hash, \" nonce=\").concat(this.nonce, \" value=\").concat(this.value, \" \");\n        postfix += \"signed=\".concat(isSigned, \" hf=\").concat(hf);\n        return postfix;\n    };\n    return BaseTransaction;\n}());\nexports.BaseTransaction = BaseTransaction;\n//# sourceMappingURL=baseTransaction.js.map"]},"metadata":{},"sourceType":"script"}